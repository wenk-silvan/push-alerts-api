íA
QC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Controllers\AuthController.cs
	namespace 	
PushAlertsApi
 
. 
Controllers #
{		 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IUsersService &
_usersService' 4
;4 5
public 
AuthController 
( 
IConfiguration ,
configuration- :
,: ;
DataContext< G
contextH O
)O P
{ 	
_configuration 
= 
configuration *
;* +
_context 
= 
context 
; 
_usersService 
= 
new 
UsersService  ,
(, -
context- 4
.4 5
Users5 :
): ;
;; <
} 	
[%% 	

ApiKeyAuth%%	 
]%% 
[&& 	
HttpPost&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
ActionResult'' 
Register'' $
(''$ %
[''% &

FromHeader''& 0
(''0 1
Name''1 5
=''6 7
$str''8 @
)''@ A
]''A B
string''C I
key''J M
,''M N
[''O P
FromBody''P X
]''X Y
Credentials''Z e
request''f m
)''m n
{(( 	
var)) 
email)) 
=)) 
request)) 
?))  
.))  !
Email))! &
.))& '
Trim))' +
())+ ,
))), -
.))- .
ToLower)). 5
())5 6
)))6 7
;))7 8
var** 
password** 
=** 
request** "
?**" #
.**# $
Password**$ ,
.**, -
Trim**- 1
(**1 2
)**2 3
;**3 4
if++ 
(++ 
!++ 
IsEmailValid++ 
(++ 
email++ #
)++# $
||++% '
!++( )
IsPasswordValid++) 8
(++8 9
password++9 A
)++A B
)++B C
{,, 
return-- 

BadRequest-- !
(--! "
$str--" >
)--> ?
;--? @
}.. 
if00 
(00 
_usersService00 
.00 
GetUserByEmail00 ,
(00, -
email00- 2
!002 3
)003 4
!=005 7
null008 <
)00< =
{11 
return22 

BadRequest22 !
(22! "
$str22" 8
)228 9
;229 :
}33 
_usersService55 
.55 
CreatePasswordHash55 ,
(55, -
password55- 5
!555 6
,556 7
out558 ;
var55< ?
passwordHash55@ L
,55L M
out55N Q
var55R U
passwordSalt55V b
)55b c
;55c d
var66 
user66 
=66 
_usersService66 $
.66$ %
AddUser66% ,
(66, -
new66- 0
User661 5
(665 6
email666 ;
!66; <
,66< =
passwordHash66> J
,66J K
passwordSalt66L X
)66X Y
)66Y Z
;66Z [
_context77 
.77 
SaveChanges77  
(77  !
)77! "
;77" #
return88 
Ok88 
(88 
user88 
)88 
;88 
}99 	
[AA 	
HttpPostAA	 
(AA 
$strAA 
)AA 
]AA 
publicBB 
ActionResultBB 
<BB 
TokenBB !
>BB! "
LoginBB# (
(BB( )
[BB) *
FromBodyBB* 2
]BB2 3
CredentialsBB4 ?
?BB? @
requestBBA H
)BBH I
{CC 	
varDD 
emailDD 
=DD 
requestDD 
?DD  
.DD  !
EmailDD! &
.DD& '
TrimDD' +
(DD+ ,
)DD, -
.DD- .
ToLowerDD. 5
(DD5 6
)DD6 7
;DD7 8
varEE 
passwordEE 
=EE 
requestEE "
?EE" #
.EE# $
PasswordEE$ ,
.EE, -
TrimEE- 1
(EE1 2
)EE2 3
;EE3 4
varGG 
potentialUserGG 
=GG 
_usersServiceGG  -
.GG- .
GetUserByEmailGG. <
(GG< =
emailGG= B
!GGB C
)GGC D
;GGD E
ifHH 
(HH 
potentialUserHH 
==HH  
nullHH! %
||HH& (
potentialUserHH) 6
.HH6 7
EmailHH7 <
!=HH= ?
emailHH@ E
)HHE F
{II 
returnJJ 

BadRequestJJ !
(JJ! "
$strJJ" 3
)JJ3 4
;JJ4 5
}KK 
ifMM 
(MM 
!MM 
_usersServiceMM 
.MM 
VerifyPasswordHashMM 1
(MM1 2
passwordMM2 :
!MM: ;
,MM; <
potentialUserMM= J
.MMJ K
PasswordHashMMK W
,MMW X
potentialUserNN !
.NN! "
PasswordSaltNN" .
)NN. /
)NN/ 0
{OO 
returnPP 

BadRequestPP !
(PP! "
$strPP" 3
)PP3 4
;PP4 5
}QQ 
varSS 
daysSS 
=SS 
intSS 
.SS 
TryParseSS #
(SS# $
_configurationSS$ 2
.SS2 3

GetSectionSS3 =
(SS= >
$strSS> H
)SSH I
.SSI J
ValueSSJ O
,SSO P
outSSQ T
varSSU X
resultSSY _
)SS_ `
?SSa b
resultSSc i
:SSj k
$numSSl n
;SSn o
varTT 
expiryTT 
=TT 
DateTimeTT !
.TT! "
NowTT" %
.TT% &
AddDaysTT& -
(TT- .
daysTT. 2
)TT2 3
.TT3 4
ToUniversalTimeTT4 C
(TTC D
)TTD E
;TTE F
varUU 
tokenUU 
=UU 
_usersServiceUU %
.UU% &
CreateTokenUU& 1
(UU1 2
potentialUserUU2 ?
,UU? @
_configurationUUA O
.UUO P

GetSectionUUP Z
(UUZ [
$strUU[ d
)UUd e
.UUe f
ValueUUf k
,UUk l
expiryUUm s
)UUs t
;UUt u
returnVV 
OkVV 
(VV 
newVV 
TokenVV 
(VV  
tokenVV  %
,VV% &
expiryVV' -
,VV- .
potentialUserVV/ <
.VV< =
EmailVV= B
,VVB C
potentialUserVVD Q
.VVQ R
UuidVVR V
)VVV W
)VVW X
;VVX Y
}WW 	
privateYY 
staticYY 
boolYY 
IsEmailValidYY (
(YY( )
stringYY) /
?YY/ 0
emailYY1 6
)YY6 7
{ZZ 	
return[[ 
![[ 
email[[ 
.[[ 
IsNullOrEmpty[[ '
([[' (
)[[( )
&&\\ 
email\\ 
!\\ 
.\\ 
Contains\\ %
(\\% &
$str\\& )
)\\) *
&&]] 
email]] 
.]] 
Contains]] $
(]]$ %
$str]]% (
)]]( )
;]]) *
}^^ 	
private`` 
static`` 
bool`` 
IsPasswordValid`` +
(``+ ,
string``, 2
?``2 3
password``4 <
)``< =
{aa 	
returnbb 
!bb 
passwordbb 
.bb 
IsNullOrEmptybb *
(bb* +
)bb+ ,
;bb, -
}cc 	
}dd 
}ee Ö
UC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Controllers\ProjectsController.cs
	namespace 	
PushAlertsApi
 
. 
Controllers #
{		 
[ 
ApiController 
] 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ProjectsController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ILogger  
<  !
ProjectsController! 3
>3 4
_logger5 <
;< =
private 
readonly 
IProjectsService )
_projectsService* :
;: ;
public 
ProjectsController !
(! "
ILogger" )
<) *
ProjectsController* <
>< =
logger> D
,D E
DataContextF Q
contextR Y
)Y Z
{ 	
_logger 
= 
logger 
; 
_projectsService 
= 
new "
ProjectsService# 2
(2 3
context3 :
.: ;
Projects; C
)C D
;D E
} 	
[!! 	
HttpGet!!	 
(!! 
$str!! 
)!! 
]!! 
public"" 
ActionResult"" 
<"" 
IEnumerable"" '
<""' (
Project""( /
>""/ 0
>""0 1
Get""2 5
(""5 6
string""6 <
uuidUser""= E
)""E F
{## 	
try$$ 
{%% 
return&& 
Ok&& 
(&& 
_projectsService&& *
.&&* +
GetAllProjects&&+ 9
(&&9 :
uuidUser&&: B
)&&B C
)&&C D
;&&D E
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
return** 
HandleApiException** )
(**) *
ex*** ,
)**, -
;**- .
}++ 
},, 	
private.. 
ActionResult.. 
HandleApiException.. /
(../ 0
	Exception..0 9
ex..: <
)..< =
{// 	
_logger00 
.00 
LogError00 
(00 
MessageFormatter00 -
.00- .
LogError00. 6
(006 7
ex007 9
)009 :
)00: ;
;00; <
return11 

BadRequest11 
(11 
MessageFormatter11 .
.11. /"
ActionResultBadRequest11/ E
(11E F
)11F G
)11G H
;11H I
}22 	
}33 
}44 ﬁj
RC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Controllers\TasksController.cs
	namespace 	
PushAlertsApi
 
. 
Controllers #
{ 
[ 
ApiController 
] 
[ 
	Authorize 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
TasksController  
:! "
ControllerBase# 1
{ 
private 
readonly 
ILogger  
<  !
ProjectsController! 3
>3 4
_logger5 <
;< =
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IProjectsService )
_projectsService* :
;: ;
private 
readonly 
ITasksService &
_tasksService' 4
;4 5
private 
readonly 
IUsersService &
_usersService' 4
;4 5
private   
readonly   !
INotificationsService   .!
_notificationsService  / D
;  D E
private"" 
readonly""  
IServiceScopeFactory"" - 
_serviceScopeFactory"". B
;""B C
private$$ 
readonly$$ 
IConfiguration$$ '
_configuration$$( 6
;$$6 7
public&& 
TasksController&& 
(&& 
IConfiguration&& -
configuration&&. ;
,&&; <
ILogger&&= D
<&&D E
ProjectsController&&E W
>&&W X
logger&&Y _
,&&_ `
DataContext&&a l
context&&m t
,&&t u 
IServiceScopeFactory''  
serviceScopeFactory''! 4
)''4 5
{(( 	
_logger)) 
=)) 
logger)) 
;)) 
_context** 
=** 
context** 
;** 
_configuration++ 
=++ 
configuration++ *
;++* +
_projectsService,, 
=,, 
new,, "
ProjectsService,,# 2
(,,2 3
context,,3 :
.,,: ;
Projects,,; C
),,C D
;,,D E
_tasksService-- 
=-- 
new-- 
TasksService--  ,
(--, -
context--- 4
.--4 5
Tasks--5 :
)--: ;
;--; <
_usersService.. 
=.. 
new.. 
UsersService..  ,
(.., -
context..- 4
...4 5
Users..5 :
)..: ;
;..; <!
_notificationsService// !
=//" #
new//$ ' 
NotificationsService//( <
(//< =
context//= D
.//D E
Notifications//E R
,//R S
FirebaseMessaging//T e
.//e f
DefaultInstance//f u
)//u v
;//v w
_context00 
.00 
SaveChanges00  
(00  !
)00! "
;00" # 
_serviceScopeFactory11  
=11! "
serviceScopeFactory11# 6
;116 7
}22 	
[99 	
HttpGet99	 
(99 
$str99 
)99 
]99 
public:: 
ActionResult:: 
<:: 
IEnumerable:: '
<::' (
Task::( ,
>::, -
>::- .
GetAllOfProject::/ >
(::> ?
string::? E
uuid::F J
)::J K
{;; 	
try<< 
{== 
var>> 
project>> 
=>> 
_projectsService>> .
.>>. /

GetProject>>/ 9
(>>9 :
uuid>>: >
)>>> ?
;>>? @
var?? 
tasks?? 
=?? 
project?? #
.??# $
Tasks??$ )
;??) *
tasks@@ 
?@@ 
.@@ 
ForEach@@ 
(@@ 
t@@  
=>@@! #
t@@$ %
.@@% &
	UserEmail@@& /
=@@0 1
t@@2 3
.@@3 4
User@@4 8
?@@8 9
.@@9 :
Email@@: ?
)@@? @
;@@@ A
returnAA 
OkAA 
(AA 
projectAA !
.AA! "
TasksAA" '
)AA' (
;AA( )
}BB 
catchCC 
(CC 
	ExceptionCC 
exCC 
)CC  
{DD 
returnEE 
HandleApiExceptionEE )
(EE) *
exEE* ,
)EE, -
;EE- .
}FF 
}GG 	
[RR 	

ApiKeyAuthRR	 
]RR 
[SS 	
HttpPostSS	 
(SS 
$strSS !
)SS! "
,SS" #
AllowAnonymousSS$ 2
]SS2 3
publicTT 
asyncTT 
TaskTT 
<TT 
ActionResultTT &
<TT& '
TaskTT' +
>TT+ ,
>TT, -
AddTT. 1
(TT1 2
[TT2 3

FromHeaderTT3 =
(TT= >
NameTT> B
=TTC D
$strTTE M
)TTM N
]TTN O
stringTTP V
keyTTW Z
,TTZ [
stringTT\ b
uuidProjectTTc n
,TTn o
NewTaskUU 
taskUU 
)UU 
{VV 	
tryWW 
{XX 
varYY 
projectYY 
=YY 
_projectsServiceYY .
.YY. /

GetProjectYY/ 9
(YY9 :
uuidProjectYY: E
)YYE F
;YYF G
varZZ 
newTaskZZ 
=ZZ 
_tasksServiceZZ +
.ZZ+ ,
AddTaskZZ, 3
(ZZ3 4
projectZZ4 ;
,ZZ; <
taskZZ= A
)ZZA B
;ZZB C
await[[ 
_context[[ 
.[[ 
SaveChangesAsync[[ /
([[/ 0
)[[0 1
;[[1 2!
_notificationsService\\ %
.\\% &
NotifyUsers\\& 1
(\\1 2
$"\\2 4
$str\\4 <
{\\< =
project\\= D
.\\D E
Name\\E I
}\\I J
$str\\J ]
{\\] ^
task\\^ b
.\\b c
Source\\c i
}\\i j
"\\j k
,\\k l
project\\m t
,\\t u
newTask]] 
)]] 
;]] 
var^^ 
seconds^^ 
=^^ 
int^^ !
.^^! "
TryParse^^" *
(^^* +
_configuration^^+ 9
.^^9 :

GetSection^^: D
(^^D E
$str^^E V
)^^V W
.^^W X
Value^^X ]
,^^] ^
out^^_ b
var^^c f
result^^g m
)^^m n
?__ 
result__ 
:`` 
$num`` 
;`` 
varaa 
timeraa 
=aa 
newaa 
Systemaa  &
.aa& '
Timersaa' -
.aa- .
Timeraa. 3
(aa3 4
secondsaa4 ;
*aa< =
$numaa> B
)aaB C
;aaC D
timerbb 
.bb 
Elapsedbb 
+=bb  
(bb! "
(bb" #
senderbb# )
,bb) *
argsbb+ /
)bb/ 0
=>bb1 3$
OnReminderJobTimerFinishbb4 L
(bbL M
timerbbM R
,bbR S
newTaskbbT [
.bb[ \
Uuidbb\ `
)bb` a
)bba b
;bbb c
timercc 
.cc 
Enabledcc 
=cc 
truecc  $
;cc$ %
awaitdd 
_contextdd 
.dd 
SaveChangesAsyncdd /
(dd/ 0
)dd0 1
;dd1 2
returnee 
Okee 
(ee 
newTaskee !
)ee! "
;ee" #
}ff 
catchgg 
(gg 
	Exceptiongg 
exgg 
)gg  
{hh 
returnii 
HandleApiExceptionii )
(ii) *
exii* ,
)ii, -
;ii- .
}jj 
}kk 	
[ss 	
HttpPutss	 
(ss 
$strss /
)ss/ 0
]ss0 1
publictt 
ActionResulttt 
Assigntt "
(tt" #
stringtt# )
uuidTasktt* 2
,tt2 3
stringtt4 :
uuidUsertt; C
)ttC D
{uu 	
tryvv 
{ww 
varxx 
userxx 
=xx 
_usersServicexx (
.xx( )
GetUserByUuidxx) 6
(xx6 7
uuidUserxx7 ?
)xx? @
;xx@ A
_tasksServiceyy 
.yy 

AssignTaskyy (
(yy( )
uuidTaskyy) 1
,yy1 2
useryy3 7
)yy7 8
;yy8 9
_contextzz 
.zz 
SaveChangeszz $
(zz$ %
)zz% &
;zz& '
return{{ 
Ok{{ 
({{ 
){{ 
;{{ 
}|| 
catch}} 
(}} 
	Exception}} 
ex}} 
)}}  
{~~ 
return 
HandleApiException )
() *
ex* ,
), -
;- .
}
ÄÄ 
}
ÅÅ 	
[
ââ 	
HttpPut
ââ	 
(
ââ 
$str
ââ $
)
ââ$ %
]
ââ% &
public
ää 
ActionResult
ää 
Close
ää !
(
ää! "
string
ää" (
uuidTask
ää) 1
,
ää1 2
	TaskState
ää3 <
status
ää= C
)
ääC D
{
ãã 	
try
åå 
{
çç 
_tasksService
éé 
.
éé 
	CloseTask
éé '
(
éé' (
uuidTask
éé( 0
,
éé0 1
status
éé2 8
)
éé8 9
;
éé9 :
_context
èè 
.
èè 
SaveChanges
èè $
(
èè$ %
)
èè% &
;
èè& '
return
êê 
Ok
êê 
(
êê 
)
êê 
;
êê 
}
ëë 
catch
íí 
(
íí 
	Exception
íí 
ex
íí 
)
íí  
{
ìì 
return
îî  
HandleApiException
îî )
(
îî) *
ex
îî* ,
)
îî, -
;
îî- .
}
ïï 
}
ññ 	
private
òò 
ActionResult
òò  
HandleApiException
òò /
(
òò/ 0
	Exception
òò0 9
ex
òò: <
)
òò< =
{
ôô 	
_logger
öö 
.
öö 
LogError
öö 
(
öö 
MessageFormatter
öö -
.
öö- .
LogError
öö. 6
(
öö6 7
ex
öö7 9
)
öö9 :
)
öö: ;
;
öö; <
return
õõ 

BadRequest
õõ 
(
õõ 
MessageFormatter
õõ .
.
õõ. /$
ActionResultBadRequest
õõ/ E
(
õõE F
)
õõF G
)
õõG H
;
õõH I
}
úú 	
private
ûû 
void
ûû &
OnReminderJobTimerFinish
ûû -
(
ûû- .
IDisposable
ûû. 9
timer
ûû: ?
,
ûû? @
Guid
ûûA E
taskUuid
ûûF N
)
ûûN O
{
üü 	
using
°° 
var
°° 
scope
°° 
=
°° "
_serviceScopeFactory
°° 2
.
°°2 3
CreateScope
°°3 >
(
°°> ?
)
°°? @
;
°°@ A
using
¢¢ 
var
¢¢ 
currentDbContext
¢¢ &
=
¢¢' (
scope
¢¢) .
.
¢¢. /
ServiceProvider
¢¢/ >
.
¢¢> ? 
GetRequiredService
¢¢? Q
<
¢¢Q R
DataContext
¢¢R ]
>
¢¢] ^
(
¢¢^ _
)
¢¢_ `
;
¢¢` a
var
££ 
task
££ 
=
££ 
new
££ 
TasksService
££ '
(
££' (
currentDbContext
££( 8
.
££8 9
Tasks
££9 >
)
££> ?
.
££? @
GetTask
££@ G
(
££G H
taskUuid
££H P
.
££P Q
ToString
££Q Y
(
££Y Z
)
££Z [
)
££[ \
;
££\ ]
var
§§ 
project
§§ 
=
§§ 
new
§§ 
ProjectsService
§§ -
(
§§- .
currentDbContext
§§. >
.
§§> ?
Projects
§§? G
)
§§G H
.
§§H I

GetProject
§§I S
(
§§S T
task
§§T X
.
§§X Y
	ProjectId
§§Y b
)
§§b c
;
§§c d
if
•• 
(
•• 
task
•• 
.
•• 
Status
•• 
==
•• 
	TaskState
•• (
.
••( )
Opened
••) /
)
••/ 0
{
¶¶ 
new
ßß "
NotificationsService
ßß (
(
ßß( )
currentDbContext
ßß) 9
.
ßß9 :
Notifications
ßß: G
,
ßßG H
FirebaseMessaging
ßßI Z
.
ßßZ [
DefaultInstance
ßß[ j
)
ßßj k
.
ßßk l
NotifyUsers
ßßl w
(
ßßw x
$"
®® 
$str
®® )
{
®®) *
task
®®* .
.
®®. /
Title
®®/ 4
}
®®4 5
$str
®®5 B
{
®®B C
project
®®C J
.
®®J K
Name
®®K O
}
®®O P
"
®®P Q
,
®®Q R
project
®®S Z
,
®®Z [
task
®®\ `
)
®®` a
;
®®a b
}
©© 
else
™™ 
{
´´ 
timer
¨¨ 
.
¨¨ 
Dispose
¨¨ 
(
¨¨ 
)
¨¨ 
;
¨¨  
}
≠≠ 
currentDbContext
ØØ 
.
ØØ 
SaveChanges
ØØ (
(
ØØ( )
)
ØØ) *
;
ØØ* +
}
∞∞ 	
}
±± 
}≤≤ ø
GC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Data\DataContext.cs
	namespace 	
PushAlertsApi
 
. 
Data 
{ 
public 

class 
DataContext 
: 
	DbContext (
{ 
public 
DataContext 
( 
DbContextOptions +
<+ ,
DataContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
{ 	
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
optionsBuilder 
. !
UseLazyLoadingProxies 0
(0 1
)1 2
;2 3
} 	
public 
virtual 
DbSet 
< 
Project $
>$ %
Projects& .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
virtual 
DbSet 
< 
Task !
>! "
Tasks# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
virtual 
DbSet 
< 
User !
>! "
Users# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
virtual 
DbSet 
< 
TaskNotification -
>- .
Notifications/ <
{= >
get? B
;B C
setD G
;G H
}I J
} 
} Û
RC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Filters\ApiKeyAuthAttribute.cs
	namespace 	
PushAlertsApi
 
. 
Filters 
{ 
[

 
AttributeUsage

 
(

 
AttributeTargets

 $
.

$ %
Class

% *
|

+ ,
AttributeTargets

- =
.

= >
Method

> D
)

D E
]

E F
public 

class 
ApiKeyAuthAttribute $
:% &
	Attribute' 0
,0 1
IAsyncActionFilter2 D
{ 
private 
const 
string 
ApiKeyHeaderName -
=. /
$str0 8
;8 9
public 
async 
Task "
OnActionExecutionAsync 0
(0 1"
ActionExecutingContext1 G
contextH O
,O P#
ActionExecutionDelegateQ h
nexti m
)m n
{ 	
if 
( 
! 
context 
. 
HttpContext $
.$ %
Request% ,
., -
Headers- 4
.4 5
TryGetValue5 @
(@ A
ApiKeyHeaderNameA Q
,Q R
outS V
varW Z
potentialApiKey[ j
)j k
)k l
{ 
context 
. 
Result 
=  
new! $
UnauthorizedResult% 7
(7 8
)8 9
;9 :
return 
; 
} 
var 
configuration 
= 
context  '
.' (
HttpContext( 3
.3 4
RequestServices4 C
.C D
GetRequiredServiceD V
<V W
IConfigurationW e
>e f
(f g
)g h
;h i
var 
apiKey 
= 
configuration &
.& '
GetValue' /
</ 0
string0 6
>6 7
(7 8
ApiKeyHeaderName8 H
)H I
;I J
if   
(   
!   
apiKey   
.   
Equals   
(   
potentialApiKey   .
)  . /
)  / 0
{!! 
context"" 
."" 
Result"" 
=""  
new""! $
UnauthorizedResult""% 7
(""7 8
)""8 9
;""9 :
return## 
;## 
}$$ 
await&& 
next&& 
(&& 
)&& 
;&& 
}'' 	
}(( 
})) ã\
^C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220309155731_CreateInitial.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
CreateInitial &
:' (
	Migration) 2
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Uuid 
= 
table  
.  !
Column! '
<' (
Guid( ,
>, -
(- .
type. 2
:2 3
$str4 F
,F G
nullableH P
:P Q
falseR W
)W X
,X Y
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
falseQ V
)V W
,W X
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= L
,L M
nullableN V
:V W
falseX ]
)] ^
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Uuid   
=   
table    
.    !
Column  ! '
<  ' (
Guid  ( ,
>  , -
(  - .
type  . 2
:  2 3
$str  4 F
,  F G
nullable  H P
:  P Q
false  R W
)  W X
,  X Y
Email!! 
=!! 
table!! !
.!!! "
Column!!" (
<!!( )
string!!) /
>!!/ 0
(!!0 1
type!!1 5
:!!5 6
$str!!7 F
,!!F G
nullable!!H P
:!!P Q
false!!R W
)!!W X
,!!X Y
	ProjectId"" 
="" 
table""  %
.""% &
Column""& ,
<"", -
int""- 0
>""0 1
(""1 2
type""2 6
:""6 7
$str""8 =
,""= >
nullable""? G
:""G H
true""I M
)""M N
}## 
,## 
constraints$$ 
:$$ 
table$$ "
=>$$# %
{%% 
table&& 
.&& 

PrimaryKey&& $
(&&$ %
$str&&% /
,&&/ 0
x&&1 2
=>&&3 5
x&&6 7
.&&7 8
Id&&8 :
)&&: ;
;&&; <
table'' 
.'' 

ForeignKey'' $
(''$ %
name(( 
:(( 
$str(( ;
,((; <
column)) 
:)) 
x))  !
=>))" $
x))% &
.))& '
	ProjectId))' 0
,))0 1
principalTable** &
:**& '
$str**( 2
,**2 3
principalColumn++ '
:++' (
$str++) -
)++- .
;++. /
},, 
),, 
;,, 
migrationBuilder.. 
... 
CreateTable.. (
(..( )
name// 
:// 
$str// 
,// 
columns00 
:00 
table00 
=>00 !
new00" %
{11 
Id22 
=22 
table22 
.22 
Column22 %
<22% &
int22& )
>22) *
(22* +
type22+ /
:22/ 0
$str221 6
,226 7
nullable228 @
:22@ A
false22B G
)22G H
.33 

Annotation33 #
(33# $
$str33$ 8
,338 9
$str33: @
)33@ A
,33A B
Uuid44 
=44 
table44  
.44  !
Column44! '
<44' (
Guid44( ,
>44, -
(44- .
type44. 2
:442 3
$str444 F
,44F G
nullable44H P
:44P Q
false44R W
)44W X
,44X Y
Title55 
=55 
table55 !
.55! "
Column55" (
<55( )
string55) /
>55/ 0
(550 1
type551 5
:555 6
$str557 F
,55F G
nullable55H P
:55P Q
false55R W
)55W X
,55X Y
Description66 
=66  !
table66" '
.66' (
Column66( .
<66. /
string66/ 5
>665 6
(666 7
type667 ;
:66; <
$str66= L
,66L M
nullable66N V
:66V W
false66X ]
)66] ^
,66^ _
Source77 
=77 
table77 "
.77" #
Column77# )
<77) *
string77* 0
>770 1
(771 2
type772 6
:776 7
$str778 G
,77G H
nullable77I Q
:77Q R
false77S X
)77X Y
,77Y Z
	CreatedAt88 
=88 
table88  %
.88% &
Column88& ,
<88, -
DateTime88- 5
>885 6
(886 7
type887 ;
:88; <
$str88= H
,88H I
nullable88J R
:88R S
false88T Y
)88Y Z
,88Z [

AssignedAt99 
=99  
table99! &
.99& '
Column99' -
<99- .
DateTime99. 6
>996 7
(997 8
type998 <
:99< =
$str99> I
,99I J
nullable99K S
:99S T
true99U Y
)99Y Z
,99Z [
ClosedAt:: 
=:: 
table:: $
.::$ %
Column::% +
<::+ ,
DateTime::, 4
>::4 5
(::5 6
type::6 :
:::: ;
$str::< G
,::G H
nullable::I Q
:::Q R
true::S W
)::W X
,::X Y
Payload;; 
=;; 
table;; #
.;;# $
Column;;$ *
<;;* +
string;;+ 1
>;;1 2
(;;2 3
type;;3 7
:;;7 8
$str;;9 H
,;;H I
nullable;;J R
:;;R S
true;;T X
);;X Y
,;;Y Z
UserId<< 
=<< 
table<< "
.<<" #
Column<<# )
<<<) *
int<<* -
><<- .
(<<. /
type<</ 3
:<<3 4
$str<<5 :
,<<: ;
nullable<<< D
:<<D E
true<<F J
)<<J K
,<<K L
Status== 
=== 
table== "
.==" #
Column==# )
<==) *
int==* -
>==- .
(==. /
type==/ 3
:==3 4
$str==5 :
,==: ;
nullable==< D
:==D E
false==F K
)==K L
,==L M
	ProjectId>> 
=>> 
table>>  %
.>>% &
Column>>& ,
<>>, -
int>>- 0
>>>0 1
(>>1 2
type>>2 6
:>>6 7
$str>>8 =
,>>= >
nullable>>? G
:>>G H
true>>I M
)>>M N
}?? 
,?? 
constraints@@ 
:@@ 
table@@ "
=>@@# %
{AA 
tableBB 
.BB 

PrimaryKeyBB $
(BB$ %
$strBB% /
,BB/ 0
xBB1 2
=>BB3 5
xBB6 7
.BB7 8
IdBB8 :
)BB: ;
;BB; <
tableCC 
.CC 

ForeignKeyCC $
(CC$ %
nameDD 
:DD 
$strDD ;
,DD; <
columnEE 
:EE 
xEE  !
=>EE" $
xEE% &
.EE& '
	ProjectIdEE' 0
,EE0 1
principalTableFF &
:FF& '
$strFF( 2
,FF2 3
principalColumnGG '
:GG' (
$strGG) -
)GG- .
;GG. /
tableHH 
.HH 

ForeignKeyHH $
(HH$ %
nameII 
:II 
$strII 5
,II5 6
columnJJ 
:JJ 
xJJ  !
=>JJ" $
xJJ% &
.JJ& '
UserIdJJ' -
,JJ- .
principalTableKK &
:KK& '
$strKK( /
,KK/ 0
principalColumnLL '
:LL' (
$strLL) -
)LL- .
;LL. /
}MM 
)MM 
;MM 
migrationBuilderOO 
.OO 
CreateIndexOO (
(OO( )
namePP 
:PP 
$strPP *
,PP* +
tableQQ 
:QQ 
$strQQ 
,QQ 
columnRR 
:RR 
$strRR #
)RR# $
;RR$ %
migrationBuilderTT 
.TT 
CreateIndexTT (
(TT( )
nameUU 
:UU 
$strUU '
,UU' (
tableVV 
:VV 
$strVV 
,VV 
columnWW 
:WW 
$strWW  
)WW  !
;WW! "
migrationBuilderYY 
.YY 
CreateIndexYY (
(YY( )
nameZZ 
:ZZ 
$strZZ *
,ZZ* +
table[[ 
:[[ 
$str[[ 
,[[ 
column\\ 
:\\ 
$str\\ #
)\\# $
;\\$ %
}]] 	
	protected__ 
override__ 
void__ 
Down__  $
(__$ %
MigrationBuilder__% 5
migrationBuilder__6 F
)__F G
{`` 	
migrationBuilderaa 
.aa 
	DropTableaa &
(aa& '
namebb 
:bb 
$strbb 
)bb 
;bb 
migrationBuilderdd 
.dd 
	DropTabledd &
(dd& '
nameee 
:ee 
$stree 
)ee 
;ee 
migrationBuildergg 
.gg 
	DropTablegg &
(gg& '
namehh 
:hh 
$strhh  
)hh  !
;hh! "
}ii 	
}jj 
}kk ëH
cC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322092027_AddProjectsToUsers.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
AddProjectsToUsers +
:, -
	Migration. 7
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str 3
,3 4
table 
: 
$str 
) 
;  
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str 3
,3 4
table 
: 
$str 
) 
;  
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str *
,* +
table 
: 
$str 
) 
;  
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str !
,! "
table 
: 
$str 
) 
;  
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table 
: 
$str 
) 
;  
migrationBuilder   
.   
AlterColumn   (
<  ( )
int  ) ,
>  , -
(  - .
name!! 
:!! 
$str!! !
,!!! "
table"" 
:"" 
$str"" 
,"" 
type## 
:## 
$str## 
,## 
nullable$$ 
:$$ 
false$$ 
,$$  
defaultValue%% 
:%% 
$num%% 
,%%  

oldClrType&& 
:&& 
typeof&& "
(&&" #
int&&# &
)&&& '
,&&' (
oldType'' 
:'' 
$str'' 
,'' 
oldNullable(( 
:(( 
true(( !
)((! "
;((" #
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ #
,++# $
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 

ProjectsId.. 
=..  
table..! &
...& '
Column..' -
<..- .
int... 1
>..1 2
(..2 3
type..3 7
:..7 8
$str..9 >
,..> ?
nullable..@ H
:..H I
false..J O
)..O P
,..P Q
UsersId// 
=// 
table// #
.//# $
Column//$ *
<//* +
int//+ .
>//. /
(/// 0
type//0 4
://4 5
$str//6 ;
,//; <
nullable//= E
://E F
false//G L
)//L M
}00 
,00 
constraints11 
:11 
table11 "
=>11# %
{22 
table33 
.33 

PrimaryKey33 $
(33$ %
$str33% 5
,335 6
x337 8
=>339 ;
new33< ?
{33@ A
x33B C
.33C D

ProjectsId33D N
,33N O
x33P Q
.33Q R
UsersId33R Y
}33Z [
)33[ \
;33\ ]
table44 
.44 

ForeignKey44 $
(44$ %
name55 
:55 
$str55 B
,55B C
column66 
:66 
x66  !
=>66" $
x66% &
.66& '

ProjectsId66' 1
,661 2
principalTable77 &
:77& '
$str77( 2
,772 3
principalColumn88 '
:88' (
$str88) -
,88- .
onDelete99  
:99  !
ReferentialAction99" 3
.993 4
Cascade994 ;
)99; <
;99< =
table:: 
.:: 

ForeignKey:: $
(::$ %
name;; 
:;; 
$str;; <
,;;< =
column<< 
:<< 
x<<  !
=><<" $
x<<% &
.<<& '
UsersId<<' .
,<<. /
principalTable== &
:==& '
$str==( /
,==/ 0
principalColumn>> '
:>>' (
$str>>) -
,>>- .
onDelete??  
:??  !
ReferentialAction??" 3
.??3 4
Cascade??4 ;
)??; <
;??< =
}@@ 
)@@ 
;@@ 
migrationBuilderBB 
.BB 
CreateIndexBB (
(BB( )
nameCC 
:CC 
$strCC .
,CC. /
tableDD 
:DD 
$strDD $
,DD$ %
columnEE 
:EE 
$strEE !
)EE! "
;EE" #
migrationBuilderGG 
.GG 
AddForeignKeyGG *
(GG* +
nameHH 
:HH 
$strHH 3
,HH3 4
tableII 
:II 
$strII 
,II 
columnJJ 
:JJ 
$strJJ #
,JJ# $
principalTableKK 
:KK 
$strKK  *
,KK* +
principalColumnLL 
:LL  
$strLL! %
,LL% &
onDeleteMM 
:MM 
ReferentialActionMM +
.MM+ ,
CascadeMM, 3
)MM3 4
;MM4 5
}NN 	
	protectedPP 
overridePP 
voidPP 
DownPP  $
(PP$ %
MigrationBuilderPP% 5
migrationBuilderPP6 F
)PPF G
{QQ 	
migrationBuilderRR 
.RR 
DropForeignKeyRR +
(RR+ ,
nameSS 
:SS 
$strSS 3
,SS3 4
tableTT 
:TT 
$strTT 
)TT 
;TT  
migrationBuilderVV 
.VV 
	DropTableVV &
(VV& '
nameWW 
:WW 
$strWW #
)WW# $
;WW$ %
migrationBuilderYY 
.YY 
	AddColumnYY &
<YY& '
intYY' *
>YY* +
(YY+ ,
nameZZ 
:ZZ 
$strZZ !
,ZZ! "
table[[ 
:[[ 
$str[[ 
,[[ 
type\\ 
:\\ 
$str\\ 
,\\ 
nullable]] 
:]] 
true]] 
)]] 
;]]  
migrationBuilder__ 
.__ 
	AddColumn__ &
<__& '
Guid__' +
>__+ ,
(__, -
name`` 
:`` 
$str`` 
,`` 
tableaa 
:aa 
$straa 
,aa 
typebb 
:bb 
$strbb (
,bb( )
nullablecc 
:cc 
falsecc 
,cc  
defaultValuedd 
:dd 
newdd !
Guiddd" &
(dd& '
$strdd' M
)ddM N
)ddN O
;ddO P
migrationBuilderff 
.ff 
AlterColumnff (
<ff( )
intff) ,
>ff, -
(ff- .
namegg 
:gg 
$strgg !
,gg! "
tablehh 
:hh 
$strhh 
,hh 
typeii 
:ii 
$strii 
,ii 
nullablejj 
:jj 
truejj 
,jj 

oldClrTypekk 
:kk 
typeofkk "
(kk" #
intkk# &
)kk& '
,kk' (
oldTypell 
:ll 
$strll 
)ll 
;ll  
migrationBuildernn 
.nn 
CreateIndexnn (
(nn( )
nameoo 
:oo 
$stroo *
,oo* +
tablepp 
:pp 
$strpp 
,pp 
columnqq 
:qq 
$strqq #
)qq# $
;qq$ %
migrationBuilderss 
.ss 
AddForeignKeyss *
(ss* +
namett 
:tt 
$strtt 3
,tt3 4
tableuu 
:uu 
$struu 
,uu 
columnvv 
:vv 
$strvv #
,vv# $
principalTableww 
:ww 
$strww  *
,ww* +
principalColumnxx 
:xx  
$strxx! %
)xx% &
;xx& '
migrationBuilderzz 
.zz 
AddForeignKeyzz *
(zz* +
name{{ 
:{{ 
$str{{ 3
,{{3 4
table|| 
:|| 
$str|| 
,|| 
column}} 
:}} 
$str}} #
,}}# $
principalTable~~ 
:~~ 
$str~~  *
,~~* +
principalColumn 
:  
$str! %
)% &
;& '
}
ÄÄ 	
}
ÅÅ 
}ÇÇ ó
bC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322092636_FixNoUuidForUsers.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
FixNoUuidForUsers *
:+ ,
	Migration- 6
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
	AddColumn &
<& '
Guid' +
>+ ,
(, -
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str (
,( )
nullable 
: 
false 
,  
defaultValue 
: 
new !
Guid" &
(& '
$str' M
)M N
)N O
;O P
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table 
: 
$str 
) 
;  
} 	
} 
} †
pC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322100110_MakeForeignKeyPropertiesVirtual.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class +
MakeForeignKeyPropertiesVirtual 8
:9 :
	Migration; D
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} ú
aC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220406074801_AddNotifications.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
AddNotifications )
:* +
	Migration, 5
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str %
,% &
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Uuid 
= 
table  
.  !
Column! '
<' (
Guid( ,
>, -
(- .
type. 2
:2 3
$str4 F
,F G
nullableH P
:P Q
falseR W
)W X
,X Y
Message 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
nullableJ R
:R S
falseT Y
)Y Z
,Z [
TaskId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 7
,7 8
x9 :
=>; =
x> ?
.? @
Id@ B
)B C
;C D
table 
. 

ForeignKey $
($ %
name 
: 
$str =
,= >
column 
: 
x  !
=>" $
x% &
.& '
TaskId' -
,- .
principalTable &
:& '
$str( /
,/ 0
principalColumn '
:' (
$str) -
,- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
} 
) 
; 
migrationBuilder!! 
.!! 
CreateIndex!! (
(!!( )
name"" 
:"" 
$str"" /
,""/ 0
table## 
:## 
$str## &
,##& '
column$$ 
:$$ 
$str$$  
)$$  !
;$$! "
}%% 	
	protected'' 
override'' 
void'' 
Down''  $
(''$ %
MigrationBuilder''% 5
migrationBuilder''6 F
)''F G
{(( 	
migrationBuilder)) 
.)) 
	DropTable)) &
())& '
name** 
:** 
$str** %
)**% &
;**& '
}++ 	
},, 
}-- û
`C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220410122028_AddReminderJobs.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
AddReminderJobs (
:) *
	Migration+ 4
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str $
,$ %
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Uuid 
= 
table  
.  !
Column! '
<' (
Guid( ,
>, -
(- .
type. 2
:2 3
$str4 F
,F G
nullableH P
:P Q
falseR W
)W X
,X Y
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= H
,H I
nullableJ R
:R S
falseT Y
)Y Z
,Z [
TaskId 
= 
table "
." #
Column# )
<) *
int* -
>- .
(. /
type/ 3
:3 4
$str5 :
,: ;
nullable< D
:D E
falseF K
)K L
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 6
,6 7
x8 9
=>: <
x= >
.> ?
Id? A
)A B
;B C
table 
. 

ForeignKey $
($ %
name 
: 
$str <
,< =
column 
: 
x  !
=>" $
x% &
.& '
TaskId' -
,- .
principalTable &
:& '
$str( /
,/ 0
principalColumn '
:' (
$str) -
,- .
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
} 
) 
; 
migrationBuilder!! 
.!! 
CreateIndex!! (
(!!( )
name"" 
:"" 
$str"" .
,"". /
table## 
:## 
$str## %
,##% &
column$$ 
:$$ 
$str$$  
)$$  !
;$$! "
}%% 	
	protected'' 
override'' 
void'' 
Down''  $
(''$ %
MigrationBuilder''% 5
migrationBuilder''6 F
)''F G
{(( 	
migrationBuilder)) 
.)) 
	DropTable)) &
())& '
name** 
:** 
$str** $
)**$ %
;**% &
}++ 	
},, 
}-- ¸)
^C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220425083742_AddAuthToUser.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
AddAuthToUser &
:' (
	Migration) 2
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str $
)$ %
;% &
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str &
,& '
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str &
,& '
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
$num' (
]( )
)) *
;* +
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder   
.   

DropColumn   '
(  ' (
name!! 
:!! 
$str!! $
,!!$ %
table"" 
:"" 
$str"" 
)"" 
;""  
migrationBuilder$$ 
.$$ 

DropColumn$$ '
($$' (
name%% 
:%% 
$str%% $
,%%$ %
table&& 
:&& 
$str&& 
)&& 
;&&  
migrationBuilder(( 
.(( 
CreateTable(( (
(((( )
name)) 
:)) 
$str)) $
,))$ %
columns** 
:** 
table** 
=>** !
new**" %
{++ 
Id,, 
=,, 
table,, 
.,, 
Column,, %
<,,% &
int,,& )
>,,) *
(,,* +
type,,+ /
:,,/ 0
$str,,1 6
,,,6 7
nullable,,8 @
:,,@ A
false,,B G
),,G H
.-- 

Annotation-- #
(--# $
$str--$ 8
,--8 9
$str--: @
)--@ A
,--A B
TaskId.. 
=.. 
table.. "
..." #
Column..# )
<..) *
int..* -
>..- .
(... /
type../ 3
:..3 4
$str..5 :
,..: ;
nullable..< D
:..D E
false..F K
)..K L
,..L M
	CreatedAt// 
=// 
table//  %
.//% &
Column//& ,
<//, -
DateTime//- 5
>//5 6
(//6 7
type//7 ;
://; <
$str//= H
,//H I
nullable//J R
://R S
false//T Y
)//Y Z
,//Z [
Uuid00 
=00 
table00  
.00  !
Column00! '
<00' (
Guid00( ,
>00, -
(00- .
type00. 2
:002 3
$str004 F
,00F G
nullable00H P
:00P Q
false00R W
)00W X
}11 
,11 
constraints22 
:22 
table22 "
=>22# %
{33 
table44 
.44 

PrimaryKey44 $
(44$ %
$str44% 6
,446 7
x448 9
=>44: <
x44= >
.44> ?
Id44? A
)44A B
;44B C
table55 
.55 

ForeignKey55 $
(55$ %
name66 
:66 
$str66 <
,66< =
column77 
:77 
x77  !
=>77" $
x77% &
.77& '
TaskId77' -
,77- .
principalTable88 &
:88& '
$str88( /
,88/ 0
principalColumn99 '
:99' (
$str99) -
,99- .
onDelete::  
:::  !
ReferentialAction::" 3
.::3 4
Cascade::4 ;
)::; <
;::< =
};; 
);; 
;;; 
migrationBuilder== 
.== 
CreateIndex== (
(==( )
name>> 
:>> 
$str>> .
,>>. /
table?? 
:?? 
$str?? %
,??% &
column@@ 
:@@ 
$str@@  
)@@  !
;@@! "
}AA 	
}BB 
}CC ∫(
>C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddDbContext 
< 
DataContext )
>) *
(* +
options+ 2
=>3 5
{ 
options 
. 
UseSqlServer 
( 
builder  
.  !
Configuration! .
.. /
GetConnectionString/ B
(B C
$strC O
)O P
)P Q
;Q R
} 
) 
; 
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
options &
=>' )
{ 
options 
. !
AddSecurityDefinition !
(! "
$str" *
,* +
new, /!
OpenApiSecurityScheme0 E
{ 
Description 
= 
$str b
,b c
In 

= 
ParameterLocation 
. 
Header %
,% &
Name 
= 
$str 
, 
Type 
= 
SecuritySchemeType !
.! "
ApiKey" (
} 
) 
; 
options   
.   
OperationFilter   
<   /
#SecurityRequirementsOperationFilter   ?
>  ? @
(  @ A
)  A B
;  B C
}!! 
)!! 
;!! 
builder## 
.## 
Services## 
.## 
AddAuthentication## "
(##" #
JwtBearerDefaults### 4
.##4 5 
AuthenticationScheme##5 I
)##I J
.##J K
AddJwtBearer##K W
(##W X
options##X _
=>##` b
options$$ 
.$$ %
TokenValidationParameters$$ %
=$$& '
new$$( +%
TokenValidationParameters$$, E
{%% $
ValidateIssuerSigningKey&&  
=&&! "
true&&# '
,&&' (
IssuerSigningKey'' 
='' 
new''  
SymmetricSecurityKey'' 3
(''3 4
Encoding''4 <
.''< =
UTF8''= A
.(( 
GetBytes(( 
((( 
builder(( 
.(( 
Configuration(( +
.((+ ,

GetSection((, 6
(((6 7
$str((7 @
)((@ A
.((A B
Value((B G
)((G H
)((H I
,((I J
ValidateIssuer)) 
=)) 
false)) 
,)) 
ValidateAudience** 
=** 
false**  
,**  !
ValidateLifetime++ 
=++ 
true++ 
,++  
	ClockSkew,, 
=,, 
TimeSpan,, 
.,, 
Zero,, !
}-- 
)-- 
;-- 
FirebaseApp// 
.// 
Create// 
(// 
new// 

AppOptions// !
(//! "
)//" #
{00 

Credential11 
=11 
GoogleCredential11 !
.11! "
FromFile11" *
(11* +
Path22 
.22 
Combine22 
(22 
	AppDomain22 
.22 
CurrentDomain22 ,
.22, -
BaseDirectory22- :
,22: ;
$str22< X
)22X Y
)33 
,33 
}44 
)44 
;44 
var66 
app66 
=66 	
builder66
 
.66 
Build66 
(66 
)66 
;66 
if99 
(99 
app99 
.99 
Environment99 
.99 
IsDevelopment99 !
(99! "
)99" #
)99# $
{:: 
app;; 
.;; 

UseSwagger;; 
(;; 
);; 
;;; 
app<< 
.<< 
UseSwaggerUI<< 
(<< 
options<< 
=><< 
{<<  !
options<<" )
.<<) *
SwaggerEndpoint<<* 9
(<<9 :
$str<<: T
,<<T U
$str<<V \
)<<\ ]
;<<] ^
}<<_ `
)<<` a
;<<a b
}== 
app?? 
.?? 
UseAuthentication?? 
(?? 
)?? 
;?? 
appAA 
.AA 
UseAuthorizationAA 
(AA 
)AA 
;AA 
appCC 
.CC 
MapControllersCC 
(CC 
)CC 
;CC 
appEE 
.EE 
RunEE 
(EE 
)EE 	
;EE	 
≥
UC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\INotificationsService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public

 

	interface

 !
INotificationsService

 *
{ 
public 
bool 
NotifyUsers 
(  
string  &
message' .
,. /
Project0 7
project8 ?
,? @
TaskA E
taskF J
)J K
;K L
} 
} û
PC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\IProjectsService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public		 

	interface		 
IProjectsService		 %
{

 
public 
ICollection 
< 
Project "
>" #
GetAllProjects$ 2
(2 3
string3 9
uuidUser: B
)B C
;C D
public 
Project 

GetProject !
(! "
string" (
uuid) -
)- .
;. /
public 
Project 

GetProject !
(! "
int" %
id& (
)( )
;) *
} 
}   Ü
MC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\ITasksService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public 

	interface 
ITasksService "
{ 
public 
Task 
AddTask 
( 
Project #
project$ +
,+ ,
NewTask- 4
task5 9
)9 :
;: ;
public 
void 

AssignTask 
( 
string %
uuid& *
,* +
User, 0
user1 5
)5 6
;6 7
public!! 
void!! 
	CloseTask!! 
(!! 
string!! $
uuid!!% )
,!!) *
	TaskState!!+ 4
status!!5 ;
)!!; <
;!!< =
public(( 
Task(( 
GetTask(( 
((( 
string(( "
uuid((# '
)((' (
;((( )
})) 
}** ©
MC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\IUsersService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public		 

	interface		 
IUsersService		 "
{

 
public 
User 
GetUserByUuid !
(! "
string" (
uuid) -
)- .
;. /
public 
User 
? 
GetUserByEmail #
(# $
string$ *
email+ 0
)0 1
;1 2
public 
User 
AddUser 
( 
User  
user! %
)% &
;& '
public&& 
void&& 
CreatePasswordHash&& &
(&&& '
string&&' -
password&&. 6
,&&6 7
out&&8 ;
byte&&< @
[&&@ A
]&&A B
passwordHash&&C O
,&&O P
out&&Q T
byte&&U Y
[&&Y Z
]&&Z [
passwordSalt&&\ h
)&&h i
;&&i j
public// 
string// 
CreateToken// !
(//! "
User//" &
user//' +
,//+ ,
string//- 3
jwtKey//4 :
,//: ;
DateTime//< D
expiry//E K
)//K L
;//L M
public88 
bool88 
VerifyPasswordHash88 &
(88& '
string88' -
password88. 6
,886 7
byte888 <
[88< =
]88= >
passwordHash88? K
,88K L
byte88M Q
[88Q R
]88R S
passwordSalt88T `
)88` a
;88a b
}99 
}:: ø%
TC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\NotificationsService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{		 
public 

class  
NotificationsService %
:& '!
INotificationsService( =
{ 
private 
readonly 
ILogger  
<  ! 
NotificationsService! 5
>5 6
_logger7 >
;> ?
private 
readonly 
DbSet 
< 
TaskNotification /
>/ 0
_dbSet1 7
;7 8
private 
readonly 
FirebaseMessaging *

_messaging+ 5
;5 6
public  
NotificationsService #
(# $
DbSet$ )
<) *
TaskNotification* :
>: ;
context< C
,C D
FirebaseMessagingE V
	messagingW `
)` a
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7 
NotificationsService7 K
>K L
(L M
)M N
;N O
_dbSet 
= 
context 
; 

_messaging 
= 
	messaging "
;" #
} 	
public 
bool 
NotifyUsers 
(  
string  &
message' .
,. /
Project0 7
project8 ?
,? @
TaskA E
taskF J
)J K
{ 	
var 
notification 
= 
new "
TaskNotification# 3
(3 4
message4 ;
,; <
task= A
)A B
;B C
StoreNotification 
( 
notification *
)* +
;+ ,
return   
SendNotification   #
(  # $
notification  $ 0
,  0 1
project  2 9
.  9 :
Name  : >
)  > ?
;  ? @
}!! 	
private## 
TaskNotification##  
StoreNotification##! 2
(##2 3
TaskNotification##3 C
notification##D P
)##P Q
{$$ 	
var%% 
result%% 
=%% 
_dbSet%% 
.%%  
Add%%  #
(%%# $
notification%%$ 0
)%%0 1
;%%1 2
_logger&& 
.&& 
LogDebug&& 
(&& 
$"&& 
$str&& N
{&&N O
notification&&O [
.&&[ \
Uuid&&\ `
}&&` a
$str&&a b
"&&b c
)&&c d
;&&d e
return'' 
result'' 
.'' 
Entity''  
;''  !
}(( 	
private** 
bool** 
SendNotification** %
(**% &
TaskNotification**& 6
notification**7 C
,**C D
string**E K
topic**L Q
)**Q R
{++ 	
try,, 
{-- 
var.. 
message.. 
=.. 
new.. !
Message.." )
(..) *
)..* +
{// 
Data00 
=00 
null00 
,00  
Notification11  
=11! "
new11# &
Notification11' 3
{22 
Title33 
=33 
notification33  ,
.33, -
Message33- 4
,334 5
Body44 
=44 
notification44 +
.44+ ,
Task44, 0
.440 1
Title441 6
}55 
,55 
Topic66 
=66 
topic66 !
}77 
;77 
_logger99 
.99 
LogDebug99  
(99  !
$"99! #
$str99# H
{99H I
notification99I U
.99U V
Uuid99V Z
}99Z [
$str99[ \
"99\ ]
)99] ^
;99^ _
var:: 
result:: 
=:: 

_messaging:: '
.::' (
	SendAsync::( 1
(::1 2
message::2 9
)::9 :
;::: ;
return;; 
true;; 
;;; 
}<< 
catch== 
(== &
FirebaseMessagingException== -
ex==. 0
)==0 1
{>> 
_logger?? 
.?? 
LogError??  
(??  !
MessageFormatter??! 1
.??1 2
LogError??2 :
(??: ;
ex??; =
)??= >
)??> ?
;??? @
return@@ 
false@@ 
;@@ 
}AA 
}BB 	
}CC 
}DD Ú
OC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\ProjectsService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public		 

class		 
ProjectsService		  
:		! "
IProjectsService		# 3
{

 
private 
readonly 
ILogger  
<  !
ProjectsService! 0
>0 1
_logger2 9
;9 :
private 
readonly 
DbSet 
< 
Project &
>& '
_dbSet( .
;. /
public 
ProjectsService 
( 
DbSet $
<$ %
Project% ,
>, -
context. 5
)5 6
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
ProjectsService7 F
>F G
(G H
)H I
;I J
_dbSet 
= 
context 
; 
} 	
public 
ICollection 
< 
Project "
>" #
GetAllProjects$ 2
(2 3
string3 9
uuidUser: B
)B C
{ 	
var 
uuid 
= 
Guid 
. 
TryParse $
($ %
uuidUser% -
,- .
out/ 2
var3 6
result7 =
)= >
?? @
resultA G
:H I
GuidJ N
.N O
EmptyO T
;T U
var 
projects 
= 
_dbSet !
. 
Where 
( 
p 
=> 
p 
. 
Users #
.# $
ToList$ *
(* +
)+ ,
., -
Any- 0
(0 1
u1 2
=>3 5
u6 7
.7 8
Uuid8 <
=== ?
uuid@ D
)D E
)E F
. 
ToList 
( 
) 
; 
_logger 
. 
LogInformation "
(" #
$"# %
$str% -
{- .
projects. 6
.6 7
Count7 <
}< =
$str= U
"U V
)V W
;W X
return 
projects 
; 
} 	
public 
Project 

GetProject !
(! "
string" (
uuid) -
)- .
{   	
var!! 
project!! 
=!! 
_dbSet!!  
.!!  !
Single!!! '
(!!' (
p!!( )
=>!!* ,
p!!- .
.!!. /
Uuid!!/ 3
==!!4 6
Guid!!7 ;
.!!; <
Parse!!< A
(!!A B
uuid!!B F
)!!F G
)!!G H
;!!H I
_logger"" 
."" 
LogInformation"" "
(""" #
$"""# %
$str""% O
{""O P
uuid""P T
}""T U
$str""U W
"""W X
)""X Y
;""Y Z
return## 
project## 
;## 
}$$ 	
public&& 
Project&& 

GetProject&& !
(&&! "
int&&" %
id&&& (
)&&( )
{'' 	
var(( 
project(( 
=(( 
_dbSet((  
.((  !
First((! &
(((& '
p((' (
=>(() +
p((, -
.((- .
Id((. 0
==((1 3
id((4 6
)((6 7
;((7 8
_logger)) 
.)) 
LogInformation)) "
())" #
$"))# %
$str))% M
{))M N
id))N P
}))P Q
$str))Q S
"))S T
)))T U
;))U V
return** 
project** 
;** 
}++ 	
},, 
}-- Ë:
LC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\TasksService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public

 

class

 
TasksService

 
:

 
ITasksService

  -
{ 
private 
readonly 
ILogger  
<  !
TasksService! -
>- .
_logger/ 6
;6 7
private 
readonly 
DbSet 
< 
Task #
># $
_dbSet% +
;+ ,
public 
TasksService 
( 
DbSet !
<! "
Task" &
>& '
context( /
)/ 0
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
TasksService7 C
>C D
(D E
)E F
;F G
_dbSet 
= 
context 
; 
} 	
public 
Task 
AddTask 
( 
Project #
project$ +
,+ ,
NewTask- 4
newTask5 <
)< =
{ 	
var 
task 
= 
new 
Task 
(  
newTask  '
.' (
Title( -
,- .
newTask/ 6
.6 7
Description7 B
,B C
newTaskD K
.K L
SourceL R
,R S
projectT [
.[ \
Id\ ^
,^ _
newTask` g
.g h
Payloadh o
)o p
;p q
var 
result 
= 
_dbSet 
.  
Add  #
(# $
task$ (
)( )
;) *
_logger 
. 
LogInformation "
(" #
$"# %
$str% @
{@ A
taskA E
.E F
UuidF J
}J K
$strK d
{d e
projecte l
.l m
Uuidm q
}q r
$strr s
"s t
)t u
;u v
return 
result 
. 
Entity  
;  !
} 	
public 
void 

AssignTask 
( 
string %
uuid& *
,* +
User, 0
user1 5
)5 6
{ 	
if   
(   
user   
==   
null   
)   
throw   #
new  $ '!
ArgumentNullException  ( =
(  = >
nameof  > D
(  D E
user  E I
)  I J
)  J K
;  K L
var!! 
dbTask!! 
=!! 
GetTask!!  
(!!  !
uuid!!! %
)!!% &
;!!& '
if"" 
("" 
dbTask"" 
."" 
Status"" 
!=""  
	TaskState""! *
.""* +
Opened""+ 1
)""1 2
throw## 
new## %
InvalidOperationException## 3
(##3 4
$"##4 6
$str##6 V
{##V W
dbTask##W ]
.##] ^
Status##^ d
}##d e
$str##e f
"##f g
)##g h
;##h i
dbTask$$ 
.$$ 

AssignedAt$$ 
=$$ 
DateTime$$  (
.$$( )
Now$$) ,
;$$, -
dbTask%% 
.%% 
Status%% 
=%% 
	TaskState%% %
.%%% &
Assigned%%& .
;%%. /
dbTask&& 
.&& 
User&& 
=&& 
user&& 
;&& 
_dbSet'' 
.'' 
Update'' 
('' 
dbTask''  
)''  !
;''! "
_logger(( 
.(( 
LogInformation(( "
(((" #
$"((# %
$str((% ?
{((? @
uuid((@ D
}((D E
$str((E [
{(([ \
user((\ `
.((` a
Uuid((a e
}((e f
$str((f g
"((g h
)((h i
;((i j
})) 	
public++ 
void++ 
	CloseTask++ 
(++ 
string++ $
uuid++% )
,++) *
	TaskState+++ 4
status++5 ;
)++; <
{,, 	
if-- 
(-- 
status-- 
!=-- 
	TaskState-- #
.--# $
Done--$ (
&&--) +
status--, 2
!=--3 5
	TaskState--6 ?
.--? @
Rejected--@ H
)--H I
{.. 
var// 
error// 
=// 
$"00 
$str00 =
{00= >
	TaskState00> G
.00G H
Done00H L
}00L M
$str00M Q
{00Q R
	TaskState00R [
.00[ \
Rejected00\ d
}00d e
$str00e h
{00h i
status00i o
}00o p
$str00p q
"00q r
;00r s
_logger11 
.11 
LogDebug11  
(11  !
error11! &
)11& '
;11' (
throw22 
new22 
ArgumentException22 +
(22+ ,
error22, 1
)221 2
;222 3
}33 
var55 
dbTask55 
=55 
GetTask55  
(55  !
uuid55! %
)55% &
;55& '
if66 
(66 
dbTask66 
.66 
Status66 
!=66  
	TaskState66! *
.66* +
Assigned66+ 3
)663 4
{77 
throw88 
new88 %
InvalidOperationException88 3
(883 4
$"884 6
$str886 U
{88U V
uuid88V Z
}88Z [
$str88[ r
"88r s
)88s t
;88t u
}99 
dbTask;; 
.;; 
Status;; 
=;; 
status;; "
;;;" #
dbTask<< 
.<< 
ClosedAt<< 
=<< 
DateTime<< &
.<<& '
Now<<' *
;<<* +
_logger== 
.== 
LogInformation== "
(==" #
$"==# %
$str==% =
{=== >
uuid==> B
}==B C
$str==C X
{==X Y
dbTask==Y _
.==_ `
Status==` f
}==f g
$str==g h
"==h i
)==i j
;==j k
}>> 	
public@@ 
Task@@ 
GetTask@@ 
(@@ 
string@@ "
uuid@@# '
)@@' (
{AA 	
varBB 
taskBB 
=BB 
_dbSetBB 
.BB 
FirstBB #
(BB# $
tBB$ %
=>BB& (
tBB) *
.BB* +
UuidBB+ /
==BB0 2
GuidBB3 7
.BB7 8
ParseBB8 =
(BB= >
uuidBB> B
)BBB C
)BBC D
;BBD E
_loggerCC 
.CC 
LogInformationCC "
(CC" #
$"CC# %
$strCC% I
{CCI J
uuidCCJ N
}CCN O
$strCCO [
{CC[ \
taskCC\ `
.CC` a
IdCCa c
}CCc d
$strCCd e
"CCe f
)CCf g
;CCg h
returnDD 
taskDD 
;DD 
}EE 	
}FF 
}GG Î@
LC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\UsersService.cs
	namespace		 	
PushAlertsApi		
 
.		 
Services		  
{

 
public 

class 
UsersService 
: 
IUsersService  -
{ 
private 
readonly 
ILogger  
<  !
UsersService! -
>- .
_logger/ 6
;6 7
private 
readonly 
DbSet 
< 
User #
># $
_dbSet% +
;+ ,
public 
UsersService 
( 
DbSet !
<! "
User" &
>& '
context( /
)/ 0
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
UsersService7 C
>C D
(D E
)E F
;F G
_dbSet 
= 
context 
; 
} 	
public 
User 
GetUserByUuid !
(! "
string" (
uuid) -
)- .
{ 	
var 
user 
= 
_dbSet 
. 
Single $
($ %
u% &
=>' )
u* +
.+ ,
Uuid, 0
==1 3
Guid4 8
.8 9
Parse9 >
(> ?
uuid? C
)C D
)D E
;E F
_logger 
. 
LogInformation "
(" #
$"# %
$str% R
{R S
userS W
.W X
IdX Z
}Z [
$str[ ]
"] ^
)^ _
;_ `
return 
user 
; 
} 	
public!! 
User!! 
?!! 
GetUserByEmail!! #
(!!# $
string!!$ *
email!!+ 0
)!!0 1
{"" 	
var## 
user## 
=## 
_dbSet## 
.## 
SingleOrDefault## -
(##- .
u##. /
=>##0 2
u##3 4
.##4 5
Email##5 :
==##; =
email##> C
)##C D
;##D E
if$$ 
($$ 
user$$ 
!=$$ 
null$$ 
)$$ 
{%% 
_logger&& 
.&& 
LogInformation&& &
(&&& '
$"&&' )
$str&&) W
{&&W X
user&&X \
.&&\ ]
Id&&] _
}&&_ `
$str&&` b
"&&b c
)&&c d
;&&d e
}'' 
return)) 
user)) 
;)) 
}** 	
public,, 
User,, 
AddUser,, 
(,, 
User,,  
user,,! %
),,% &
{-- 	
var.. 
entity.. 
=.. 
_dbSet.. 
...  
Add..  #
(..# $
user..$ (
)..( )
...) *
Entity..* 0
;..0 1
_logger// 
.// 
LogInformation// "
(//" #
$"//# %
$str//% F
{//F G
user//G K
.//K L
Id//L N
}//N O
$str//O Q
"//Q R
)//R S
;//S T
return00 
entity00 
;00 
}11 	
public33 
void33 
CreatePasswordHash33 &
(33& '
string33' -
password33. 6
,336 7
out338 ;
byte33< @
[33@ A
]33A B
passwordHash33C O
,33O P
out33Q T
byte33U Y
[33Y Z
]33Z [
passwordSalt33\ h
)33h i
{44 	
using55 
var55 
hmac55 
=55 
new55  

HMACSHA51255! +
(55+ ,
)55, -
;55- .
passwordSalt66 
=66 
hmac66 
.66  
Key66  #
;66# $
passwordHash77 
=77 
hmac77 
.77  
ComputeHash77  +
(77+ ,
System77, 2
.772 3
Text773 7
.777 8
Encoding778 @
.77@ A
UTF877A E
.77E F
GetBytes77F N
(77N O
password77O W
)77W X
)77X Y
;77Y Z
_logger88 
.88 
LogInformation88 "
(88" #
$"88# %
$str88% =
{88= >
passwordSalt88> J
}88J K
$str88K b
{88b c
passwordHash88c o
}88o p
$str88p q
"88q r
)88r s
;88s t
}99 	
public;; 
string;; 
CreateToken;; !
(;;! "
User;;" &
user;;' +
,;;+ ,
string;;- 3
jwtKey;;4 :
,;;: ;
DateTime;;< D
expiry;;E K
);;K L
{<< 	
var== 
claims== 
=== 
new== 
List== !
<==! "
Claim==" '
>==' (
{>> 
new?? 
(?? 

ClaimTypes?? 
.?? 
Email?? $
,??$ %
user??& *
.??* +
Email??+ 0
)??0 1
}@@ 
;@@ 
varBB 
keyBB 
=BB 
newBB  
SymmetricSecurityKeyBB .
(BB. /
SystemBB/ 5
.BB5 6
TextBB6 :
.BB: ;
EncodingBB; C
.BBC D
UTF8BBD H
.BBH I
GetBytesBBI Q
(BBQ R
jwtKeyBBR X
)BBX Y
)BBY Z
;BBZ [
varCC 
credentialsCC 
=CC 
newCC !
SigningCredentialsCC" 4
(CC4 5
keyCC5 8
,CC8 9
SecurityAlgorithmsCC: L
.CCL M
HmacSha512SignatureCCM `
)CC` a
;CCa b
varDD 
tokenDD 
=DD 
newDD 
JwtSecurityTokenDD ,
(DD, -
claimsEE 
:EE 
claimsEE 
,EE 
expiresFF 
:FF 
expiryFF 
,FF  
signingCredentialsGG "
:GG" #
credentialsGG$ /
)GG/ 0
;GG0 1
varHH 
jwtHH 
=HH 
newHH #
JwtSecurityTokenHandlerHH 1
(HH1 2
)HH2 3
.HH3 4

WriteTokenHH4 >
(HH> ?
tokenHH? D
)HHD E
;HHE F
_loggerII 
.II 
LogInformationII "
(II" #
$"II# %
$strII% >
{II> ?
jwtII? B
}IIB C
$strIIC D
"IID E
)IIE F
;IIF G
returnJJ 
jwtJJ 
;JJ 
}KK 	
publicMM 
boolMM 
VerifyPasswordHashMM &
(MM& '
stringMM' -
passwordMM. 6
,MM6 7
byteMM8 <
[MM< =
]MM= >
passwordHashMM? K
,MMK L
byteMMM Q
[MMQ R
]MMR S
passwordSaltMMT `
)MM` a
{NN 	
usingOO 
varOO 
hmacOO 
=OO 
newOO  

HMACSHA512OO! +
(OO+ ,
passwordSaltOO, 8
)OO8 9
;OO9 :
varPP 
computedHashPP 
=PP 
hmacPP #
.PP# $
ComputeHashPP$ /
(PP/ 0
SystemPP0 6
.PP6 7
TextPP7 ;
.PP; <
EncodingPP< D
.PPD E
UTF8PPE I
.PPI J
GetBytesPPJ R
(PPR S
passwordPPS [
)PP[ \
)PP\ ]
;PP] ^
varQQ 
equalityQQ 
=QQ 
computedHashQQ '
.QQ' (
SequenceEqualQQ( 5
(QQ5 6
passwordHashQQ6 B
)QQB C
;QQC D
_loggerRR 
.RR 
LogInformationRR "
(RR" #
$"RR# %
$strRR% A
{RRA B
equalityRRB J
}RRJ K
"RRK L
)RRL M
;RRM N
returnSS 
equalitySS 
;SS 
}TT 	
}UU 
}VV Æ	
LC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Util\MessageFormatter.cs
	namespace 	
PushAlertsApi
 
. 
Util 
{ 
public 

static 
class 
MessageFormatter (
{ 
public 
static 
string 
LogError %
(% &
	Exception& /
ex0 2
)2 3
{ 	
return 
$" 
$str (
{( )
ex) +
.+ ,
Message, 3
}3 4
$str4 O
"O P
+Q R
$" 
{ 
ex 
. 
InnerException '
?' (
.( )
Message) 0
}0 1
$str1 @
{@ A
exA C
.C D

StackTraceD N
}N O
"O P
;P Q
} 	
public 
static 
string "
ActionResultBadRequest 3
(3 4
)4 5
{ 	
return 
$" 
$str ,
", -
;- .
} 	
} 
} 