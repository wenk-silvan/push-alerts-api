 
UC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Controllers\ProjectsController.cs
	namespace 	
PushAlertsApi
 
. 
Controllers #
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
ProjectsController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ILogger  
<  !
ProjectsController! 3
>3 4
_logger5 <
;< =
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
ProjectsService (
_projectsService) 9
;9 :
private 
readonly 
TasksService %
_tasksService& 3
;3 4
public 
ProjectsController !
(! "
ILogger" )
<) *
ProjectsController* <
>< =
logger> D
,D E
DataContextF Q
contextR Y
)Y Z
{ 	
_logger 
= 
logger 
; 
_context 
= 
context 
; 
_projectsService 
= 
new "
ProjectsService# 2
(2 3
context3 :
.: ;
Projects; C
)C D
;D E
_tasksService 
= 
new 
TasksService  ,
(, -
context- 4
.4 5
Tasks5 :
): ;
;; <
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (

ProjectDto( 2
>2 3
>3 4
Get5 8
(8 9
)9 :
{   	
try!! 
{"" 
return## 
Ok## 
(## 
_projectsService## *
.##* +
GetAllProjects##+ 9
(##9 :
)##: ;
)##; <
;##< =
}$$ 
catch%% 
(%% 
	Exception%% 
ex%% 
)%%  
{&& 
_logger'' 
.'' 
LogError''  
(''  !
$"''! #
$str''# 6
{''6 7
ex''7 9
.''9 :
Message'': A
}''A B
$str''B ]
"''] ^
+''_ `
$"((! #
{((# $
ex(($ &
.((& '
InnerException((' 5
?((5 6
.((6 7
Message((7 >
}((> ?
$str((? N
{((N O
ex((O Q
.((Q R

StackTrace((R \
}((\ ]
"((] ^
)((^ _
;((_ `
return)) 

BadRequest)) !
())! "
$"))" $
$str))$ R
"))R S
)))S T
;))T U
}** 
}++ 	
},, 
}-- ýM
RC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Controllers\TasksController.cs
	namespace		 	
PushAlertsApi		
 
.		 
Controllers		 #
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
TasksController  
:! "
ControllerBase# 1
{ 
private 
readonly 
ILogger  
<  !
ProjectsController! 3
>3 4
_logger5 <
;< =
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
ProjectsService (
_projectsService) 9
;9 :
private 
readonly 
TasksService %
_tasksService& 3
;3 4
private 
readonly 
UsersService %
_usersService& 3
;3 4
public 
TasksController 
( 
ILogger &
<& '
ProjectsController' 9
>9 :
logger; A
,A B
DataContextC N
contextO V
)V W
{ 	
_logger 
= 
logger 
; 
_context 
= 
context 
; 
_projectsService 
= 
new "
ProjectsService# 2
(2 3
context3 :
.: ;
Projects; C
)C D
;D E
_tasksService 
= 
new 
TasksService  ,
(, -
context- 4
.4 5
Tasks5 :
): ;
;; <
_usersService 
= 
new 
UsersService  ,
(, -
context- 4
.4 5
Users5 :
): ;
;; <
}   	
["" 	
HttpGet""	 
("" 
$str"" 
)"" 
]"" 
public## 
ActionResult## 
<## 
IEnumerable## '
<##' (
TaskDto##( /
>##/ 0
>##0 1
Get##2 5
(##5 6
string##6 <
uuid##= A
)##A B
{$$ 	
try%% 
{&& 
var'' 
project'' 
='' 
_projectsService'' .
.''. /

GetProject''/ 9
(''9 :
uuid'': >
)''> ?
;''? @
var(( 
tasks(( 
=(( 
TaskDto(( #
.((# $
CopyAll(($ +
(((+ ,
project((, 3
.((3 4
Tasks((4 9
!((9 :
)((: ;
;((; <
return)) 
Ok)) 
()) 
tasks)) 
)))  
;))  !
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
_logger-- 
.-- 
LogError--  
(--  !
$"--! #
$str--# 6
{--6 7
ex--7 9
.--9 :
Message--: A
}--A B
$str--B ]
"--] ^
+--_ `
$"..! #
{..# $
ex..$ &
...& '
InnerException..' 5
?..5 6
...6 7
Message..7 >
}..> ?
$str..? N
{..N O
ex..O Q
...Q R

StackTrace..R \
}..\ ]
"..] ^
)..^ _
;.._ `
return// 

BadRequest// !
(//! "
$"//" $
$str//$ Z
{//Z [
uuid//[ _
}//_ `
$str//` b
"//b c
)//c d
;//d e
}00 
}11 	
[33 	
HttpPost33	 
(33 
$str33 !
)33! "
]33" #
public44 
ActionResult44 
<44 
TaskDto44 #
>44# $
Post44% )
(44) *
string44* 0
uuidProject441 <
,44< =
TaskDto44> E
task44F J
)44J K
{55 	
try66 
{77 
var88 
project88 
=88 
_projectsService88 .
.88. /

GetProject88/ 9
(889 :
uuidProject88: E
)88E F
;88F G
var99 
newTask99 
=99 
_tasksService99 +
.99+ ,
AddTask99, 3
(993 4
project994 ;
,99; <
task99= A
)99A B
;99B C
_context:: 
.:: 
SaveChanges:: $
(::$ %
)::% &
;::& '
return;; 
Ok;; 
(;; 
newTask;; !
);;! "
;;;" #
}<< 
catch== 
(== !
ArgumentNullException== (
ex==) +
)==+ ,
{>> 
_logger?? 
.?? 
LogError??  
(??  !
$"??! #
$str??# 6
{??6 7
ex??7 9
.??9 :
Message??: A
}??A B
$str??B ]
"??] ^
+??_ `
$"@@! #
{@@# $
ex@@$ &
.@@& '
InnerException@@' 5
?@@5 6
.@@6 7
Message@@7 >
}@@> ?
$str@@? N
{@@N O
ex@@O Q
.@@Q R

StackTrace@@R \
}@@\ ]
"@@] ^
)@@^ _
;@@_ `
returnAA 

BadRequestAA !
(AA! "
$"AA" $
$strAA$ O
{AAO P
uuidProjectAAP [
}AA[ \
$strAA\ ^
"AA^ _
)AA_ `
;AA` a
}BB 
catchCC 
(CC 
FormatExceptionCC "
exCC# %
)CC% &
{DD 
_loggerEE 
.EE 
LogErrorEE  
(EE  !
$"EE! #
$strEE# 6
{EE6 7
exEE7 9
.EE9 :
MessageEE: A
}EEA B
$strEEB ]
"EE] ^
+EE_ `
$"FF! #
{FF# $
exFF$ &
.FF& '
InnerExceptionFF' 5
?FF5 6
.FF6 7
MessageFF7 >
}FF> ?
$strFF? N
{FFN O
exFFO Q
.FFQ R

StackTraceFFR \
}FF\ ]
"FF] ^
)FF^ _
;FF_ `
returnGG 

BadRequestGG !
(GG! "
$"GG" $
$strGG$ a
{GGa b
uuidProjectGGb m
}GGm n
$strGGn p
"GGp q
)GGq r
;GGr s
}HH 
}II 	
[KK 	
HttpPutKK	 
(KK 
$strKK /
)KK/ 0
]KK0 1
publicLL 
ActionResultLL 
<LL 
TaskDtoLL #
>LL# $
PutLL% (
(LL( )
stringLL) /
uuidTaskLL0 8
,LL8 9
stringLL: @
uuidUserLLA I
)LLI J
{MM 	
tryNN 
{OO 
varPP 
userPP 
=PP 
_usersServicePP (
.PP( )
GetUserPP) 0
(PP0 1
uuidUserPP1 9
)PP9 :
;PP: ;
_tasksServiceQQ 
.QQ 

AssignTaskQQ (
(QQ( )
uuidTaskQQ) 1
,QQ1 2
userQQ3 7
)QQ7 8
;QQ8 9
_contextRR 
.RR 
SaveChangesRR $
(RR$ %
)RR% &
;RR& '
returnSS 
OkSS 
(SS 
)SS 
;SS 
}TT 
catchUU 
(UU 
	ExceptionUU 
exUU 
)UU  
{VV 
_loggerWW 
.WW 
LogErrorWW  
(WW  !
$"WW! #
$strWW# 6
{WW6 7
exWW7 9
.WW9 :
MessageWW: A
}WWA B
$strWWB ]
"WW] ^
+WW_ `
$"XX! #
{XX# $
exXX$ &
.XX& '
InnerExceptionXX' 5
?XX5 6
.XX6 7
MessageXX7 >
}XX> ?
$strXX? N
{XXN O
exXXO Q
.XXQ R

StackTraceXXR \
}XX\ ]
"XX] ^
)XX^ _
;XX_ `
returnYY 

BadRequestYY !
(YY! "
$"YY" $
$strYY$ P
"YYP Q
)YYQ R
;YYR S
}ZZ 
}[[ 	
[]] 	
HttpPut]]	 
(]] 
$str]] $
)]]$ %
]]]% &
public^^ 
ActionResult^^ 
<^^ 
TaskDto^^ #
>^^# $
Put^^% (
(^^( )
string^^) /
uuidTask^^0 8
,^^8 9
	TaskState^^: C
status^^D J
)^^J K
{__ 	
try`` 
{aa 
_tasksServicebb 
.bb 
	CloseTaskbb '
(bb' (
uuidTaskbb( 0
,bb0 1
statusbb2 8
)bb8 9
;bb9 :
_contextcc 
.cc 
SaveChangescc $
(cc$ %
)cc% &
;cc& '
returndd 
Okdd 
(dd 
)dd 
;dd 
}ee 
catchff 
(ff 
	Exceptionff 
exff 
)ff  
{gg 
_loggerhh 
.hh 
LogErrorhh  
(hh  !
$"hh! #
$strhh# 6
{hh6 7
exhh7 9
.hh9 :
Messagehh: A
}hhA B
$strhhB ]
"hh] ^
+hh_ `
$"ii! #
{ii# $
exii$ &
.ii& '
InnerExceptionii' 5
?ii5 6
.ii6 7
Messageii7 >
}ii> ?
$strii? N
{iiN O
exiiO Q
.iiQ R

StackTraceiiR \
}ii\ ]
"ii] ^
)ii^ _
;ii_ `
returnjj 

BadRequestjj !
(jj! "
$"jj" $
$strjj$ N
"jjN O
)jjO P
;jjP Q
}kk 
}ll 	
}mm 
}nn Î
GC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Data\DataContext.cs
	namespace 	
PushAlertsApi
 
. 
Data 
{ 
public 

class 
DataContext 
: 
	DbContext (
{ 
public		 
DataContext		 
(		 
DbContextOptions		 +
<		+ ,
DataContext		, 7
>		7 8
options		9 @
)		@ A
:		B C
base		D H
(		H I
options		I P
)		P Q
{

 	
} 	
	protected 
override 
void 
OnConfiguring  -
(- .#
DbContextOptionsBuilder. E
optionsBuilderF T
)T U
{ 	
optionsBuilder 
. !
UseLazyLoadingProxies 0
(0 1
)1 2
;2 3
} 	
public 
virtual 
DbSet 
< 
Project $
>$ %
Projects& .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 
virtual 
DbSet 
< 
Task !
>! "
Tasks# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
virtual 
DbSet 
< 
User !
>! "
Users# (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
} 
} \
^C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220309155731_CreateInitial.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
CreateInitial &
:' (
	Migration) 2
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Uuid 
= 
table  
.  !
Column! '
<' (
Guid( ,
>, -
(- .
type. 2
:2 3
$str4 F
,F G
nullableH P
:P Q
falseR W
)W X
,X Y
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
falseQ V
)V W
,W X
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= L
,L M
nullableN V
:V W
falseX ]
)] ^
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
.   

Annotation   #
(  # $
$str  $ 8
,  8 9
$str  : @
)  @ A
,  A B
Uuid!! 
=!! 
table!!  
.!!  !
Column!!! '
<!!' (
Guid!!( ,
>!!, -
(!!- .
type!!. 2
:!!2 3
$str!!4 F
,!!F G
nullable!!H P
:!!P Q
false!!R W
)!!W X
,!!X Y
Email"" 
="" 
table"" !
.""! "
Column""" (
<""( )
string"") /
>""/ 0
(""0 1
type""1 5
:""5 6
$str""7 F
,""F G
nullable""H P
:""P Q
false""R W
)""W X
,""X Y
	ProjectId## 
=## 
table##  %
.##% &
Column##& ,
<##, -
int##- 0
>##0 1
(##1 2
type##2 6
:##6 7
$str##8 =
,##= >
nullable##? G
:##G H
true##I M
)##M N
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% /
,''/ 0
x''1 2
=>''3 5
x''6 7
.''7 8
Id''8 :
)'': ;
;''; <
table(( 
.(( 

ForeignKey(( $
((($ %
name)) 
:)) 
$str)) ;
,)); <
column** 
:** 
x**  !
=>**" $
x**% &
.**& '
	ProjectId**' 0
,**0 1
principalTable++ &
:++& '
$str++( 2
,++2 3
principalColumn,, '
:,,' (
$str,,) -
),,- .
;,,. /
}-- 
)-- 
;-- 
migrationBuilder// 
.// 
CreateTable// (
(//( )
name00 
:00 
$str00 
,00 
columns11 
:11 
table11 
=>11 !
new11" %
{22 
Id33 
=33 
table33 
.33 
Column33 %
<33% &
int33& )
>33) *
(33* +
type33+ /
:33/ 0
$str331 6
,336 7
nullable338 @
:33@ A
false33B G
)33G H
.44 

Annotation44 #
(44# $
$str44$ 8
,448 9
$str44: @
)44@ A
,44A B
Uuid55 
=55 
table55  
.55  !
Column55! '
<55' (
Guid55( ,
>55, -
(55- .
type55. 2
:552 3
$str554 F
,55F G
nullable55H P
:55P Q
false55R W
)55W X
,55X Y
Title66 
=66 
table66 !
.66! "
Column66" (
<66( )
string66) /
>66/ 0
(660 1
type661 5
:665 6
$str667 F
,66F G
nullable66H P
:66P Q
false66R W
)66W X
,66X Y
Description77 
=77  !
table77" '
.77' (
Column77( .
<77. /
string77/ 5
>775 6
(776 7
type777 ;
:77; <
$str77= L
,77L M
nullable77N V
:77V W
false77X ]
)77] ^
,77^ _
Source88 
=88 
table88 "
.88" #
Column88# )
<88) *
string88* 0
>880 1
(881 2
type882 6
:886 7
$str888 G
,88G H
nullable88I Q
:88Q R
false88S X
)88X Y
,88Y Z
	CreatedAt99 
=99 
table99  %
.99% &
Column99& ,
<99, -
DateTime99- 5
>995 6
(996 7
type997 ;
:99; <
$str99= H
,99H I
nullable99J R
:99R S
false99T Y
)99Y Z
,99Z [

AssignedAt:: 
=::  
table::! &
.::& '
Column::' -
<::- .
DateTime::. 6
>::6 7
(::7 8
type::8 <
:::< =
$str::> I
,::I J
nullable::K S
:::S T
true::U Y
)::Y Z
,::Z [
ClosedAt;; 
=;; 
table;; $
.;;$ %
Column;;% +
<;;+ ,
DateTime;;, 4
>;;4 5
(;;5 6
type;;6 :
:;;: ;
$str;;< G
,;;G H
nullable;;I Q
:;;Q R
true;;S W
);;W X
,;;X Y
Payload<< 
=<< 
table<< #
.<<# $
Column<<$ *
<<<* +
string<<+ 1
><<1 2
(<<2 3
type<<3 7
:<<7 8
$str<<9 H
,<<H I
nullable<<J R
:<<R S
true<<T X
)<<X Y
,<<Y Z
UserId== 
=== 
table== "
.==" #
Column==# )
<==) *
int==* -
>==- .
(==. /
type==/ 3
:==3 4
$str==5 :
,==: ;
nullable==< D
:==D E
true==F J
)==J K
,==K L
Status>> 
=>> 
table>> "
.>>" #
Column>># )
<>>) *
int>>* -
>>>- .
(>>. /
type>>/ 3
:>>3 4
$str>>5 :
,>>: ;
nullable>>< D
:>>D E
false>>F K
)>>K L
,>>L M
	ProjectId?? 
=?? 
table??  %
.??% &
Column??& ,
<??, -
int??- 0
>??0 1
(??1 2
type??2 6
:??6 7
$str??8 =
,??= >
nullable??? G
:??G H
true??I M
)??M N
}@@ 
,@@ 
constraintsAA 
:AA 
tableAA "
=>AA# %
{BB 
tableCC 
.CC 

PrimaryKeyCC $
(CC$ %
$strCC% /
,CC/ 0
xCC1 2
=>CC3 5
xCC6 7
.CC7 8
IdCC8 :
)CC: ;
;CC; <
tableDD 
.DD 

ForeignKeyDD $
(DD$ %
nameEE 
:EE 
$strEE ;
,EE; <
columnFF 
:FF 
xFF  !
=>FF" $
xFF% &
.FF& '
	ProjectIdFF' 0
,FF0 1
principalTableGG &
:GG& '
$strGG( 2
,GG2 3
principalColumnHH '
:HH' (
$strHH) -
)HH- .
;HH. /
tableII 
.II 

ForeignKeyII $
(II$ %
nameJJ 
:JJ 
$strJJ 5
,JJ5 6
columnKK 
:KK 
xKK  !
=>KK" $
xKK% &
.KK& '
UserIdKK' -
,KK- .
principalTableLL &
:LL& '
$strLL( /
,LL/ 0
principalColumnMM '
:MM' (
$strMM) -
)MM- .
;MM. /
}NN 
)NN 
;NN 
migrationBuilderPP 
.PP 
CreateIndexPP (
(PP( )
nameQQ 
:QQ 
$strQQ *
,QQ* +
tableRR 
:RR 
$strRR 
,RR 
columnSS 
:SS 
$strSS #
)SS# $
;SS$ %
migrationBuilderUU 
.UU 
CreateIndexUU (
(UU( )
nameVV 
:VV 
$strVV '
,VV' (
tableWW 
:WW 
$strWW 
,WW 
columnXX 
:XX 
$strXX  
)XX  !
;XX! "
migrationBuilderZZ 
.ZZ 
CreateIndexZZ (
(ZZ( )
name[[ 
:[[ 
$str[[ *
,[[* +
table\\ 
:\\ 
$str\\ 
,\\ 
column]] 
:]] 
$str]] #
)]]# $
;]]$ %
}^^ 	
	protected`` 
override`` 
void`` 
Down``  $
(``$ %
MigrationBuilder``% 5
migrationBuilder``6 F
)``F G
{aa 	
migrationBuilderbb 
.bb 
	DropTablebb &
(bb& '
namecc 
:cc 
$strcc 
)cc 
;cc 
migrationBuilderee 
.ee 
	DropTableee &
(ee& '
nameff 
:ff 
$strff 
)ff 
;ff 
migrationBuilderhh 
.hh 
	DropTablehh &
(hh& '
nameii 
:ii 
$strii  
)ii  !
;ii! "
}jj 	
}kk 
}ll H
cC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322092027_AddProjectsToUsers.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
AddProjectsToUsers +
:, -
	Migration. 7
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str 3
,3 4
table 
: 
$str 
) 
;  
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str 3
,3 4
table 
: 
$str 
) 
;  
migrationBuilder 
. 
	DropIndex &
(& '
name 
: 
$str *
,* +
table 
: 
$str 
) 
;  
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str !
,! "
table 
: 
$str 
) 
;  
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table 
: 
$str 
) 
;  
migrationBuilder   
.   
AlterColumn   (
<  ( )
int  ) ,
>  , -
(  - .
name!! 
:!! 
$str!! !
,!!! "
table"" 
:"" 
$str"" 
,"" 
type## 
:## 
$str## 
,## 
nullable$$ 
:$$ 
false$$ 
,$$  
defaultValue%% 
:%% 
$num%% 
,%%  

oldClrType&& 
:&& 
typeof&& "
(&&" #
int&&# &
)&&& '
,&&' (
oldType'' 
:'' 
$str'' 
,'' 
oldNullable(( 
:(( 
true(( !
)((! "
;((" #
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ #
,++# $
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 

ProjectsId.. 
=..  
table..! &
...& '
Column..' -
<..- .
int... 1
>..1 2
(..2 3
type..3 7
:..7 8
$str..9 >
,..> ?
nullable..@ H
:..H I
false..J O
)..O P
,..P Q
UsersId// 
=// 
table// #
.//# $
Column//$ *
<//* +
int//+ .
>//. /
(/// 0
type//0 4
://4 5
$str//6 ;
,//; <
nullable//= E
://E F
false//G L
)//L M
}00 
,00 
constraints11 
:11 
table11 "
=>11# %
{22 
table33 
.33 

PrimaryKey33 $
(33$ %
$str33% 5
,335 6
x337 8
=>339 ;
new33< ?
{33@ A
x33B C
.33C D

ProjectsId33D N
,33N O
x33P Q
.33Q R
UsersId33R Y
}33Z [
)33[ \
;33\ ]
table44 
.44 

ForeignKey44 $
(44$ %
name55 
:55 
$str55 B
,55B C
column66 
:66 
x66  !
=>66" $
x66% &
.66& '

ProjectsId66' 1
,661 2
principalTable77 &
:77& '
$str77( 2
,772 3
principalColumn88 '
:88' (
$str88) -
,88- .
onDelete99  
:99  !
ReferentialAction99" 3
.993 4
Cascade994 ;
)99; <
;99< =
table:: 
.:: 

ForeignKey:: $
(::$ %
name;; 
:;; 
$str;; <
,;;< =
column<< 
:<< 
x<<  !
=><<" $
x<<% &
.<<& '
UsersId<<' .
,<<. /
principalTable== &
:==& '
$str==( /
,==/ 0
principalColumn>> '
:>>' (
$str>>) -
,>>- .
onDelete??  
:??  !
ReferentialAction??" 3
.??3 4
Cascade??4 ;
)??; <
;??< =
}@@ 
)@@ 
;@@ 
migrationBuilderBB 
.BB 
CreateIndexBB (
(BB( )
nameCC 
:CC 
$strCC .
,CC. /
tableDD 
:DD 
$strDD $
,DD$ %
columnEE 
:EE 
$strEE !
)EE! "
;EE" #
migrationBuilderGG 
.GG 
AddForeignKeyGG *
(GG* +
nameHH 
:HH 
$strHH 3
,HH3 4
tableII 
:II 
$strII 
,II 
columnJJ 
:JJ 
$strJJ #
,JJ# $
principalTableKK 
:KK 
$strKK  *
,KK* +
principalColumnLL 
:LL  
$strLL! %
,LL% &
onDeleteMM 
:MM 
ReferentialActionMM +
.MM+ ,
CascadeMM, 3
)MM3 4
;MM4 5
}NN 	
	protectedPP 
overridePP 
voidPP 
DownPP  $
(PP$ %
MigrationBuilderPP% 5
migrationBuilderPP6 F
)PPF G
{QQ 	
migrationBuilderRR 
.RR 
DropForeignKeyRR +
(RR+ ,
nameSS 
:SS 
$strSS 3
,SS3 4
tableTT 
:TT 
$strTT 
)TT 
;TT  
migrationBuilderVV 
.VV 
	DropTableVV &
(VV& '
nameWW 
:WW 
$strWW #
)WW# $
;WW$ %
migrationBuilderYY 
.YY 
	AddColumnYY &
<YY& '
intYY' *
>YY* +
(YY+ ,
nameZZ 
:ZZ 
$strZZ !
,ZZ! "
table[[ 
:[[ 
$str[[ 
,[[ 
type\\ 
:\\ 
$str\\ 
,\\ 
nullable]] 
:]] 
true]] 
)]] 
;]]  
migrationBuilder__ 
.__ 
	AddColumn__ &
<__& '
Guid__' +
>__+ ,
(__, -
name`` 
:`` 
$str`` 
,`` 
tableaa 
:aa 
$straa 
,aa 
typebb 
:bb 
$strbb (
,bb( )
nullablecc 
:cc 
falsecc 
,cc  
defaultValuedd 
:dd 
newdd !
Guiddd" &
(dd& '
$strdd' M
)ddM N
)ddN O
;ddO P
migrationBuilderff 
.ff 
AlterColumnff (
<ff( )
intff) ,
>ff, -
(ff- .
namegg 
:gg 
$strgg !
,gg! "
tablehh 
:hh 
$strhh 
,hh 
typeii 
:ii 
$strii 
,ii 
nullablejj 
:jj 
truejj 
,jj 

oldClrTypekk 
:kk 
typeofkk "
(kk" #
intkk# &
)kk& '
,kk' (
oldTypell 
:ll 
$strll 
)ll 
;ll  
migrationBuildernn 
.nn 
CreateIndexnn (
(nn( )
nameoo 
:oo 
$stroo *
,oo* +
tablepp 
:pp 
$strpp 
,pp 
columnqq 
:qq 
$strqq #
)qq# $
;qq$ %
migrationBuilderss 
.ss 
AddForeignKeyss *
(ss* +
namett 
:tt 
$strtt 3
,tt3 4
tableuu 
:uu 
$struu 
,uu 
columnvv 
:vv 
$strvv #
,vv# $
principalTableww 
:ww 
$strww  *
,ww* +
principalColumnxx 
:xx  
$strxx! %
)xx% &
;xx& '
migrationBuilderzz 
.zz 
AddForeignKeyzz *
(zz* +
name{{ 
:{{ 
$str{{ 3
,{{3 4
table|| 
:|| 
$str|| 
,|| 
column}} 
:}} 
$str}} #
,}}# $
principalTable~~ 
:~~ 
$str~~  *
,~~* +
principalColumn 
:  
$str! %
)% &
;& '
}
 	
}
 
} 
bC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322092636_FixNoUuidForUsers.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class 
FixNoUuidForUsers *
:+ ,
	Migration- 6
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
Guid' +
>+ ,
(, -
name 
: 
$str 
, 
table 
: 
$str 
, 
type 
: 
$str (
,( )
nullable 
: 
false 
,  
defaultValue 
: 
new !
Guid" &
(& '
$str' M
)M N
)N O
;O P
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table 
: 
$str 
) 
;  
} 	
} 
}  
pC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Migrations\20220322100110_MakeForeignKeyPropertiesVirtual.cs
	namespace 	
PushAlertsApi
 
. 

Migrations "
{ 
public 

partial 
class +
MakeForeignKeyPropertiesVirtual 8
:9 :
	Migration; D
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
} 	
} 
} 
>C:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddDbContext 
< 
DataContext )
>) *
(* +
options+ 2
=>3 5
{		 
options

 
.

 
UseSqlServer

 
(

 
builder

  
.

  !
Configuration

! .
.

. /
GetConnectionString

/ B
(

B C
$str

C O
)

O P
)

P Q
;

Q R
} 
) 
; 
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{ 
app 
. 

UseSwagger 
( 
) 
; 
app 
. 
UseSwaggerUI 
( 
) 
; 
} 
app 
. 
UseAuthorization 
( 
) 
; 
app 
. 
MapControllers 
( 
) 
; 
app 
. 
Run 
( 
) 	
;	 
Æ
OC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\ProjectsService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public		 

class		 
ProjectsService		  
{

 
private 
readonly 
ILogger  
<  !
ProjectsService! 0
>0 1
_logger2 9
;9 :
private 
readonly 
DbSet 
< 
Project &
>& '
_dbSet( .
;. /
public 
ProjectsService 
( 
DbSet $
<$ %
Project% ,
>, -
context. 5
)5 6
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
ProjectsService7 F
>F G
(G H
)H I
;I J
_dbSet 
= 
context 
; 
} 	
public 
ICollection 
< 

ProjectDto %
>% &
GetAllProjects' 5
(5 6
)6 7
{ 	
var 
projects 
= 
_dbSet !
.! "
ToList" (
(( )
)) *
;* +
_logger 
. 
LogInformation "
(" #
$"# %
$str% -
{- .
projects. 6
.6 7
Count7 <
}< =
$str= U
"U V
)V W
;W X
return 

ProjectDto 
. 
CopyAll %
(% &
projects& .
). /
;/ 0
} 	
public 
Project 

GetProject !
(! "
string" (
uuid) -
)- .
{ 	
var 
project 
= 
_dbSet  
.  !
First! &
(& '
p' (
=>) +
p, -
.- .
Uuid. 2
==3 5
Guid6 :
.: ;
Parse; @
(@ A
uuidA E
)E F
)F G
;G H
if 
( 
project 
== 
null 
)  
{   
throw!! 
new!! !
ArgumentNullException!! /
(!!/ 0
nameof!!0 6
(!!6 7
project!!7 >
)!!> ?
,!!? @
$str!!A T
)!!T U
;!!U V
}"" 
_logger## 
.## 
LogInformation## "
(##" #
$"### %
$str##% O
{##O P
uuid##P T
}##T U
$str##U W
"##W X
)##X Y
;##Y Z
return$$ 
project$$ 
;$$ 
}%% 	
}&& 
}'' ã>
LC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\TasksService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{		 
public

 

class

 
TasksService

 
{ 
private 
readonly 
ILogger  
<  !
TasksService! -
>- .
_logger/ 6
;6 7
private 
readonly 
DbSet 
< 
Task #
># $
_dbSet% +
;+ ,
public 
TasksService 
( 
DbSet !
<! "
Task" &
>& '
context( /
)/ 0
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
TasksService7 C
>C D
(D E
)E F
;F G
_dbSet 
= 
context 
; 
} 	
public 
Task 
AddTask 
( 
Project #
project$ +
,+ ,
TaskDto- 4
task5 9
)9 :
{ 	
var 
tasks 
= 
new 
Task  
(  !
task 
. 
Title 
, 
task 
. 
Description  
,  !
task 
. 
Source 
, 
project 
. 
Id 
, 
task 
. 
Payload 
) 
; 
var 
result 
= 
_dbSet 
.  
Add  #
(# $
tasks$ )
)) *
;* +
_logger   
.   
LogInformation   "
(  " #
$"  # %
$str  % @
{  @ A
task  A E
.  E F
Uuid  F J
}  J K
$str  K d
{  d e
project  e l
.  l m
Uuid  m q
}  q r
$str  r s
"  s t
)  t u
;  u v
return!! 
result!! 
.!! 
Entity!!  
;!!  !
}"" 	
public$$ 
void$$ 

AssignTask$$ 
($$ 
string$$ %
uuid$$& *
,$$* +
User$$, 0
user$$1 5
)$$5 6
{%% 	
if&& 
(&& 
user&& 
==&& 
null&& 
)&& 
throw&& #
new&&$ '!
ArgumentNullException&&( =
(&&= >
nameof&&> D
(&&D E
user&&E I
)&&I J
)&&J K
;&&K L
var'' 
dbTask'' 
='' 
GetTask''  
(''  !
uuid''! %
)''% &
;''& '
if(( 
((( 
dbTask(( 
.(( 
Status(( 
!=((  
	TaskState((! *
.((* +
Opened((+ 1
)((1 2
throw((3 8
new((9 <%
InvalidOperationException((= V
(((V W
$"((W Y
$str((Y y
{((y z
dbTask	((z 
.
(( 
Status
(( 
}
(( 
$str
(( 
"
(( 
)
(( 
;
(( 
dbTask)) 
.)) 

AssignedAt)) 
=)) 
DateTime))  (
.))( )
Now))) ,
;)), -
dbTask** 
.** 
Status** 
=** 
	TaskState** %
.**% &
Assigned**& .
;**. /
dbTask++ 
.++ 
User++ 
=++ 
user++ 
;++ 
_dbSet,, 
.,, 
Update,, 
(,, 
dbTask,,  
),,  !
;,,! "
_logger-- 
.-- 
LogInformation-- "
(--" #
$"--# %
$str--% ?
{--? @
uuid--@ D
}--D E
$str--E [
{--[ \
user--\ `
.--` a
Uuid--a e
}--e f
$str--f g
"--g h
)--h i
;--i j
}.. 	
public00 
void00 
	CloseTask00 
(00 
string00 $
uuid00% )
,00) *
	TaskState00+ 4
status005 ;
)00; <
{11 	
if22 
(22 
status22 
!=22 
	TaskState22 #
.22# $
Done22$ (
&&22) +
status22, 2
!=223 5
	TaskState226 ?
.22? @
Rejected22@ H
)22H I
{33 
string44 
error44 
=44 
$"55 
$str55 =
{55= >
	TaskState55> G
.55G H
Done55H L
}55L M
$str55M Q
{55Q R
	TaskState55R [
.55[ \
Rejected55\ d
}55d e
$str55e h
{55h i
status55i o
}55o p
$str55p q
"55q r
;55r s
_logger66 
.66 
LogDebug66  
(66  !
error66! &
)66& '
;66' (
throw77 
new77 
ArgumentException77 +
(77+ ,
error77, 1
)771 2
;772 3
}88 
var99 
dbTask99 
=99 
GetTask99  
(99  !
uuid99! %
)99% &
;99& '
if:: 
(:: 
dbTask:: 
.:: 
Status:: 
!=::  
	TaskState::! *
.::* +
Assigned::+ 3
)::3 4
throw;; 
new;; %
InvalidOperationException;; 3
(;;3 4
$";;4 6
$str;;6 U
{;;U V
uuid;;V Z
};;Z [
$str;;[ r
";;r s
);;s t
;;;t u
dbTask<< 
.<< 
Status<< 
=<< 
status<< "
;<<" #
dbTask== 
.== 
ClosedAt== 
=== 
DateTime== &
.==& '
Now==' *
;==* +
_logger>> 
.>> 
LogInformation>> "
(>>" #
$">># %
$str>>% =
{>>= >
uuid>>> B
}>>B C
$str>>C X
{>>X Y
dbTask>>Y _
.>>_ `
Status>>` f
}>>f g
$str>>g h
">>h i
)>>i j
;>>j k
}?? 	
publicAA 
TaskAA 
GetTaskAA 
(AA 
stringAA "
uuidAA# '
)AA' (
{BB 	
varCC 
taskCC 
=CC 
_dbSetCC 
.CC 
FirstOrDefaultCC ,
(CC, -
tCC- .
=>CC/ 1
tCC2 3
.CC3 4
UuidCC4 8
==CC9 ;
GuidCC< @
.CC@ A
ParseCCA F
(CCF G
uuidCCG K
)CCK L
)CCL M
;CCM N
ifDD 
(DD 
taskDD 
==DD 
nullDD 
)DD 
{EE 
stringFF 
errorFF 
=FF 
$"FF !
$strFF! @
{FF@ A
uuidFFA E
}FFE F
$strFFF G
"FFG H
;FFH I
_loggerGG 
.GG 
LogDebugGG  
(GG  !
errorGG! &
)GG& '
;GG' (
throwHH 
newHH 
ArgumentExceptionHH +
(HH+ ,
errorHH, 1
)HH1 2
;HH2 3
}II 
_loggerJJ 
.JJ 
LogInformationJJ "
(JJ" #
$"JJ# %
$strJJ% I
{JJI J
uuidJJJ N
}JJN O
$strJJO [
{JJ[ \
taskJJ\ `
.JJ` a
IdJJa c
}JJc d
$strJJd e
"JJe f
)JJf g
;JJg h
returnKK 
taskKK 
;KK 
}LL 	
}MM 
}NN ±
LC:\Development\hslu\baa\PushAlertsApi\PushAlertsApi\Services\UsersService.cs
	namespace 	
PushAlertsApi
 
. 
Services  
{ 
public 

class 
UsersService 
{		 
private

 
readonly

 
ILogger

  
<

  !
UsersService

! -
>

- .
_logger

/ 6
;

6 7
private 
readonly 
DbSet 
< 
User #
># $
_dbSet% +
;+ ,
public 
UsersService 
( 
DbSet !
<! "
User" &
>& '
context( /
)/ 0
{ 	
_logger 
= 
new 
LoggerFactory '
(' (
)( )
.) *
CreateLogger* 6
<6 7
UsersService7 C
>C D
(D E
)E F
;F G
_dbSet 
= 
context 
; 
} 	
public 
User 
GetUser 
( 
string "
uuid# '
)' (
{ 	
var 
user 
= 
_dbSet 
. 
First #
(# $
u$ %
=>& (
u) *
.* +
Uuid+ /
==0 2
Guid3 7
.7 8
Parse8 =
(= >
uuid> B
)B C
)C D
;D E
if 
( 
user 
== 
null 
) 
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
user7 ;
); <
,< =
$str> N
)N O
;O P
} 
_logger 
. 
LogInformation "
(" #
$"# %
$str% L
{L M
uuidM Q
}Q R
$strR T
"T U
)U V
;V W
return 
user 
; 
} 	
} 
} 